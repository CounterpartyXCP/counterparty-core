from btctxstore import BtcTxStore
from counterpartylib.lib.micropayments import scripts


FIXTURES = {
    "deposit": {
        "input": {
            "payer_wif": "cT5RVbfLsgdUv2EAmbckFXNcsj9EmdAVvU9m6aarXb3fUpt9xkjX",
            "rawtx": "0100000001dab5588f6df29b3f3b650f57b443bb2dbd9ba8d113dbf1f80b18b60f1a710447000000001976a914e960d8c0c0d4ee536912b4e115fb8b8d84d5330b88acffffffff03d2b400000000000017a914aa6d4750bb4db850b48ee784c5ad275f235b7f768700000000000000001e6a1cd9a71f04d5096e06527153002f7a950091739ca38e74120a36361f565e310200000000001976a914e960d8c0c0d4ee536912b4e115fb8b8d84d5330b88ac00000000"
        },
        "expected": "0100000001dab5588f6df29b3f3b650f57b443bb2dbd9ba8d113dbf1f80b18b60f1a710447000000006b483045022100ba5366aa8f8110ae52bc6ed3916ca1fcf86e7c11d6219dc398ecda528a0e4c6c02205f7e4b6177ff6a8f526fcb7ce946a70dbb0d356ca29eeba665e90fd2a2a2889c0121033faa57e0ed3a3bf89340a0a3074ce0ef403ebfb77cb3402d0daa29d808e2bde0ffffffff03d2b400000000000017a914aa6d4750bb4db850b48ee784c5ad275f235b7f768700000000000000001e6a1cd9a71f04d5096e06527153002f7a950091739ca38e74120a36361f565e310200000000001976a914e960d8c0c0d4ee536912b4e115fb8b8d84d5330b88ac00000000"
    },

    "created_commit": {
        "input": {
            "payer_wif": "cSthi1Ye1sbHepC5s8rNukQBAKLCyct6hLg6MCH9Ybk1cKfGcPb2",
            "rawtx": "01000000017231934b8873769b325c090a99dd7e5a3d8708bf13e94f677228b90787631f070000000017a9145c6f176aa8bab82688c8b07562595a622d7b889a87ffffffff03463c00000000000017a914b57a70f9301cfd13603fc36b3162b57340b3958b8700000000000000001e6a1c5144cf3299cdb4115af7e5b1a21ecac52fedaf164910f4fe4beb0a877c5100000000000017a9145c6f176aa8bab82688c8b07562595a622d7b889a8700000000",
            "deposit_script": "63522102a73443bc32f5fec6a551f71af75311b0876686156d16d367562d3d29987792d52103c7b09d53bdb0ef9cfea06c1e6f2192e6a91cdeac209402bc36c1c368021a861152ae6763a9144cc776751eb4d41f23feaf94697cb7ec2fe597a4882102a73443bc32f5fec6a551f71af75311b0876686156d16d367562d3d29987792d5ac6703ffff00b2752102a73443bc32f5fec6a551f71af75311b0876686156d16d367562d3d29987792d5ac6868"
        },
        "expected": "01000000017231934b8873769b325c090a99dd7e5a3d8708bf13e94f677228b90787631f0700000000fd460100483045022100ea61f098fdaf5b26f7b37b578ac0dcde84aec1169aa45f84a876ff97075e29c602205ec1abeb2be0efb3891e4b1cc88cc687ab8dd3c0cf7f04202b6ff1be2fe523fd01483045022100fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd036414002207fffffffffffffffffffffffffffffff5d576e7357a4501ddfe92f46681b20a001514cb063522102a73443bc32f5fec6a551f71af75311b0876686156d16d367562d3d29987792d52103c7b09d53bdb0ef9cfea06c1e6f2192e6a91cdeac209402bc36c1c368021a861152ae6763a9144cc776751eb4d41f23feaf94697cb7ec2fe597a4882102a73443bc32f5fec6a551f71af75311b0876686156d16d367562d3d29987792d5ac6703ffff00b2752102a73443bc32f5fec6a551f71af75311b0876686156d16d367562d3d29987792d5ac6868ffffffff03463c00000000000017a914b57a70f9301cfd13603fc36b3162b57340b3958b8700000000000000001e6a1c5144cf3299cdb4115af7e5b1a21ecac52fedaf164910f4fe4beb0a877c5100000000000017a9145c6f176aa8bab82688c8b07562595a622d7b889a8700000000"
    },

    "finalize_commit": {
        "input": {
            "payee_wif": "cVmyYsHfeJWmCFy7N6DUeC4aXMS8vRR57aW7eGmpFVLfSHWjZ4jc",
            "rawtx": "01000000017231934b8873769b325c090a99dd7e5a3d8708bf13e94f677228b90787631f0700000000fd460100483045022100fe849b43cc4bede5c1af9515f9e79ded1776d3163331727cd592d89a78e308da0220026fb2e681d8c7e721159f35d4e6708981e751d9c573cd7221077837d613a66601483045022100fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd036414002207fffffffffffffffffffffffffffffff5d576e7357a4501ddfe92f46681b20a001514cb063522102a73443bc32f5fec6a551f71af75311b0876686156d16d367562d3d29987792d52103c7b09d53bdb0ef9cfea06c1e6f2192e6a91cdeac209402bc36c1c368021a861152ae6763a9144cc776751eb4d41f23feaf94697cb7ec2fe597a4882102a73443bc32f5fec6a551f71af75311b0876686156d16d367562d3d29987792d5ac6703ffff00b2752102a73443bc32f5fec6a551f71af75311b0876686156d16d367562d3d29987792d5ac6868ffffffff03463c00000000000017a91454eda5ac68f27ba781f559307be015d12fdec8018700000000000000001e6a1c5144cf3299cdb4115af7e5b1a21ecac52fedaf164910f4fe4beb0a837c5100000000000017a9145c6f176aa8bab82688c8b07562595a622d7b889a8700000000",
            "deposit_script": "63522102a73443bc32f5fec6a551f71af75311b0876686156d16d367562d3d29987792d52103c7b09d53bdb0ef9cfea06c1e6f2192e6a91cdeac209402bc36c1c368021a861152ae6763a9144cc776751eb4d41f23feaf94697cb7ec2fe597a4882102a73443bc32f5fec6a551f71af75311b0876686156d16d367562d3d29987792d5ac6703ffff00b2752102a73443bc32f5fec6a551f71af75311b0876686156d16d367562d3d29987792d5ac6868"
        },
        "expected": "01000000017231934b8873769b325c090a99dd7e5a3d8708bf13e94f677228b90787631f0700000000fd460100483045022100fe849b43cc4bede5c1af9515f9e79ded1776d3163331727cd592d89a78e308da0220026fb2e681d8c7e721159f35d4e6708981e751d9c573cd7221077837d613a66601483045022100eea344bec9052b271040c69ad6d8a9fce2a860f26e8ff75ddaa361fb399df4c202200df793c7b938301f283802f8d42425709a4d45d1afdf43fa1135e9a2a94505be01514cb063522102a73443bc32f5fec6a551f71af75311b0876686156d16d367562d3d29987792d52103c7b09d53bdb0ef9cfea06c1e6f2192e6a91cdeac209402bc36c1c368021a861152ae6763a9144cc776751eb4d41f23feaf94697cb7ec2fe597a4882102a73443bc32f5fec6a551f71af75311b0876686156d16d367562d3d29987792d5ac6703ffff00b2752102a73443bc32f5fec6a551f71af75311b0876686156d16d367562d3d29987792d5ac6868ffffffff03463c00000000000017a91454eda5ac68f27ba781f559307be015d12fdec8018700000000000000001e6a1c5144cf3299cdb4115af7e5b1a21ecac52fedaf164910f4fe4beb0a837c5100000000000017a9145c6f176aa8bab82688c8b07562595a622d7b889a8700000000"
    },

    "revoke_recover": {
        "input": {
            "payer_wif": "cT9pEqELRn5v67hJmmmYQmPnsuezJeup7CqQiJBUTZnLLoxdydAb",
            "rawtx": "0200000001327f9b9cc593813acfe0e6f35b316da9c93b2356eafc9ad15d6221177147a5d80000000017a9144f6e9a81ee624f6b79b51707d912d55fbd11195e87050000000236150000000000001976a914f4daff5d2eb03b808c020f04226af126e11d4e7f88ac00000000000000001e6a1c4a7bd46ea529e60dee9f39e32723b492cb5df61cc81f772aa4787a7900000000",
            "commit_script": "6355b275a914df73599d858adb83b57f88b187420c79d95d34818821028666087223829e3932b648e42df2caac57ce677f36ded247dd0cd7c1b229d05bac67a914a9c26a254249e209d542f2ab2aff4811b36c571a882103ace51ceb3b6298812c7a643480ecd8d57c89625288f56898f6dbeb1f1431550fac68",
            "revoke_secret": "1b2b22e836852e7de54877eb8da471c28710f1b1122caae01a055aac3f4a40d3"
        },
        "expected": "0200000001327f9b9cc593813acfe0e6f35b316da9c93b2356eafc9ad15d6221177147a5d800000000e7483045022100f92252d3b8ff2ad689efa1084323bb73555a10f8bc4542ec221bf8a8328d50040220695e386cdd03a1a32a3d2972c7992c2d38b8783ade8960b77ffa9237f338899901201b2b22e836852e7de54877eb8da471c28710f1b1122caae01a055aac3f4a40d3004c7a6355b275a914df73599d858adb83b57f88b187420c79d95d34818821028666087223829e3932b648e42df2caac57ce677f36ded247dd0cd7c1b229d05bac67a914a9c26a254249e209d542f2ab2aff4811b36c571a882103ace51ceb3b6298812c7a643480ecd8d57c89625288f56898f6dbeb1f1431550fac68050000000236150000000000001976a914f4daff5d2eb03b808c020f04226af126e11d4e7f88ac00000000000000001e6a1c4a7bd46ea529e60dee9f39e32723b492cb5df61cc81f772aa4787a7900000000"
    },

    "payout_recover":{
        "input": {
            "payee_wif": "cNXoRUC2eqcBEv1AmvPgM6NgCYV1ReTTHuAmVxaAh6AvVLHroSfU",
            "rawtx": "0200000001391814005e1098bcf161b8380923041dafef9e4a06578ffa4ccf06477f4f4da40000000017a914fe2f8cd949a3cb4fe7f333e277b0d3c53e9009c487050000000236150000000000001976a914900729789e53c5fb566e400e3e03c88b0703bc5a88ac00000000000000001e6a1ce7299f7bdbc46197ae28018744dd7c9fc06b4778cf0b95a41f30ef5300000000",
            "commit_script": "6355b275a914050e1310e92253efc8cfb498d8e3594ec69f18098821028666087223829e3932b648e42df2caac57ce677f36ded247dd0cd7c1b229d05bac67a914f7dc060ff00dfed0975bb0b3815c34898203bacb882102224b63a140724dd08fa6818ec1cda07f7e5e746d5ae865dc6e72c0970b0a1bb1ac68",
            "spend_secret": "1e23f27be91c610ea4286344f9f19adca1994afa522e15afd8b0cba404e17c7b"
        },
        "expected": "0200000001391814005e1098bcf161b8380923041dafef9e4a06578ffa4ccf06477f4f4da400000000e6473044022062bef3f4b21cd53dc248e08f9bb92021c7800d43f86a17ee7eaf044b2b0f51af02201d84bcca4356f77f5c20e12fac4b959c1d9362e8d0a41efe7165b5375518252a01201e23f27be91c610ea4286344f9f19adca1994afa522e15afd8b0cba404e17c7b514c7a6355b275a914050e1310e92253efc8cfb498d8e3594ec69f18098821028666087223829e3932b648e42df2caac57ce677f36ded247dd0cd7c1b229d05bac67a914f7dc060ff00dfed0975bb0b3815c34898203bacb882102224b63a140724dd08fa6818ec1cda07f7e5e746d5ae865dc6e72c0970b0a1bb1ac68050000000236150000000000001976a914900729789e53c5fb566e400e3e03c88b0703bc5a88ac00000000000000001e6a1ce7299f7bdbc46197ae28018744dd7c9fc06b4778cf0b95a41f30ef5300000000"
    },

    "change_recover": {
        "input": {
            "payer_wif": "cQRX2dyAf1VpkhqiYAMD1Rvc8ZEksVg78rF82wRH5EePKwoD6KoW",
            "rawtx": "01000000017e616907f0091c980d61fe807127d78b8c1fe501cbf1d45247a89e1e4d5a08d20200000017a9148b5d0930c4fe33e98cd8fe793198dc561f9e935387ffffffff026c2a0000000000001976a914f39c1b3b6b45c306b4d7b208195ac29cbe17203688ac00000000000000001e6a1cfb87ba6f87556992d8608c7d48a009df13722be4ab3dbf4af53e80a100000000",
            "deposit_script": "63522102d052373cae8cfc103a6f6b386c28a7e750f1c073da3ac5e0eb4b8b3d6e324f1c21034bad5ce410ac5e7ba34c1e9c652e1bbcf061634390ed95aa9d4d716820877d7e52ae6763a9140e0c109e4750d3974f48ec2399fe36372aecabf0882102d052373cae8cfc103a6f6b386c28a7e750f1c073da3ac5e0eb4b8b3d6e324f1cac6703ffff00b2752102d052373cae8cfc103a6f6b386c28a7e750f1c073da3ac5e0eb4b8b3d6e324f1cac6868",
            "spend_secret": "08a05684632abe83b5f61d10ac8d72a3bad334b5e3cc449fbde090aad64a9a2c"
        },
        "expected": "01000000017e616907f0091c980d61fe807127d78b8c1fe501cbf1d45247a89e1e4d5a08d202000000fd1d01473044022063ae0e270de244c2b4b9c8a5cb93d63741013a5d9086f569f7c7e1a4d9525e3002200c2f9b1ce6d3fe8550944a49325f9b335ca84273dafebed7b10d67efa261f735012008a05684632abe83b5f61d10ac8d72a3bad334b5e3cc449fbde090aad64a9a2c51004cb063522102d052373cae8cfc103a6f6b386c28a7e750f1c073da3ac5e0eb4b8b3d6e324f1c21034bad5ce410ac5e7ba34c1e9c652e1bbcf061634390ed95aa9d4d716820877d7e52ae6763a9140e0c109e4750d3974f48ec2399fe36372aecabf0882102d052373cae8cfc103a6f6b386c28a7e750f1c073da3ac5e0eb4b8b3d6e324f1cac6703ffff00b2752102d052373cae8cfc103a6f6b386c28a7e750f1c073da3ac5e0eb4b8b3d6e324f1cac6868ffffffff026c2a0000000000001976a914f39c1b3b6b45c306b4d7b208195ac29cbe17203688ac00000000000000001e6a1cfb87ba6f87556992d8608c7d48a009df13722be4ab3dbf4af53e80a100000000"
    },

    "expire_recover":{
        "input": {
            "payer_wif": "cMtErY7rdk8gycybQ9nPVQ4FchyvsMYMyQHjdgobnFMFfMU6eFj3",
            "deposit_script": "6352210389bdba52b9820a4d672bbb14b6c01aa54963cc0f1419b14a01e9ebeb62ebef1f210327f017c35a46b759536309e6de256ad44ad609c1c4aed0e2cdb82f62490f75f852ae6763a914a7ec62542b0d393d43442aadf8d55f7da1e303cb88210389bdba52b9820a4d672bbb14b6c01aa54963cc0f1419b14a01e9ebeb62ebef1fac6755b275210389bdba52b9820a4d672bbb14b6c01aa54963cc0f1419b14a01e9ebeb62ebef1fac6868",
            "rawtx": "0200000001bfe7ce4db0e0b28a0ce81c01875d287531fed0bca764c7a720a17e90247dedd60000000017a914c0cb8bde9f461a63d8dddf0074a73019394bf27b870500000002c28d0000000000001976a9147f6ac1ca784f65f161d20b6dca3fa0b26449b58588ac00000000000000001e6a1c5a27a4413c05edd52be59c6ee95316bcdd7626b35d7d9c9426eb0a0800000000"
        },
        "expected": "0200000001bfe7ce4db0e0b28a0ce81c01875d287531fed0bca764c7a720a17e90247dedd600000000fa483045022100c0a60d7c7f080041b548d608cec1b063f14fb1484326e08ae4786de24ef02019022062ac373824f5b78b918b6a991db026280d5937e7c4cefefdde6b1cb0e61b5be30100004cad6352210389bdba52b9820a4d672bbb14b6c01aa54963cc0f1419b14a01e9ebeb62ebef1f210327f017c35a46b759536309e6de256ad44ad609c1c4aed0e2cdb82f62490f75f852ae6763a914a7ec62542b0d393d43442aadf8d55f7da1e303cb88210389bdba52b9820a4d672bbb14b6c01aa54963cc0f1419b14a01e9ebeb62ebef1fac6755b275210389bdba52b9820a4d672bbb14b6c01aa54963cc0f1419b14a01e9ebeb62ebef1fac68680500000002c28d0000000000001976a9147f6ac1ca784f65f161d20b6dca3fa0b26449b58588ac00000000000000001e6a1c5a27a4413c05edd52be59c6ee95316bcdd7626b35d7d9c9426eb0a0800000000"
    }
}


btctxstore = BtcTxStore(testnet=True, dryrun=True)


def test_sign_deposit():
    rawtx = scripts.sign_deposit(
        btctxstore,
        **FIXTURES["deposit"]["input"])
    assert rawtx == FIXTURES["deposit"]["expected"]


def test_sign_created_commit():
    rawtx = scripts.sign_created_commit(
        btctxstore, **FIXTURES["created_commit"]["input"]
    )
    assert rawtx == FIXTURES["created_commit"]["expected"]


def test_sign_finalize_commit():
    rawtx = scripts.sign_finalize_commit(
        btctxstore, **FIXTURES["finalize_commit"]["input"]
    )
    assert rawtx == FIXTURES["finalize_commit"]["expected"]


def test_sign_revoke_recover():
    rawtx = scripts.sign_revoke_recover(
        btctxstore, **FIXTURES["revoke_recover"]["input"]
    )
    assert rawtx == FIXTURES["revoke_recover"]["expected"]


def test_sign_payout_recover():
    rawtx = scripts.sign_payout_recover(
        btctxstore, **FIXTURES["payout_recover"]["input"]
    )
    assert rawtx == FIXTURES["payout_recover"]["expected"]


def test_sign_change_recover():
    rawtx = scripts.sign_change_recover(
        btctxstore, **FIXTURES["change_recover"]["input"]
    )
    assert rawtx == FIXTURES["change_recover"]["expected"]


def test_sign_expire_recover():
    rawtx = scripts.sign_expire_recover(
        btctxstore, **FIXTURES["expire_recover"]["input"]
    )
    assert rawtx == FIXTURES["expire_recover"]["expected"]
