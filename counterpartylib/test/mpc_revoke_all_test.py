import tempfile
import pytest

# this is require near the top to do setup of the test suite
# from counterpartylib.test import conftest

# from counterpartylib.test import util_test
from counterpartylib.test.util_test import CURR_DIR
from counterpartylib.lib import util


FIXTURE_SQL_FILE = CURR_DIR + '/fixtures/scenarios/unittest_fixture.sql'
FIXTURE_DB = tempfile.gettempdir() + '/fixtures.unittest_fixture.db'


SECRETS =  ['ea2076a688a70f6198a7cf4d6787404ad4e5ea64d30ec4fec626efa0355402dc', '79e8c6682057eb428d108bd9cfc789c6b4df7432553885e6614c0afa95a8fb3c', '23dca672ce5b47c6efb245a453b634a443b0c9270bd3d857cb7d16dce6f04cc7', 'b186cc0d480572d21d08c65389479c86811643f42ebb32d8c7b3135659a2e2b2', '3b7e393f044aba41dc3cb6bd277e64bfe941808e1b5ade352689348e51601751']
STATE_BEFORE =  {
  "commits_active": [
    {
      "rawtx": "01000000010b8043159eaef778a082a2218022ef3787c66a9c718a6872b2c4a995a3801f1a0100000017a9145c6f176aa8bab82688c8b07562595a622d7b889a87ffffffff03463c00000000000017a914858db27f807e111eb6a100e7e8e5565b5acdd6998700000000000000001e6a1ced4b809b50411b57ea163d961b24191a2a943cd88310ba580cb7f3cb4a2301000000000017a9145c6f176aa8bab82688c8b07562595a622d7b889a8700000000",
      "script": "6355b275a9144cc776751eb4d41f23feaf94697cb7ec2fe597a4882103c7b09d53bdb0ef9cfea06c1e6f2192e6a91cdeac209402bc36c1c368021a8611ac67a914f05c03057c5161a619a1951847e68eb950d10aaf882102a73443bc32f5fec6a551f71af75311b0876686156d16d367562d3d29987792d5ac68"
    },
    {
      "rawtx": "01000000010b8043159eaef778a082a2218022ef3787c66a9c718a6872b2c4a995a3801f1a0100000017a9145c6f176aa8bab82688c8b07562595a622d7b889a87ffffffff03463c00000000000017a914b2fdeffd6e76586dbe8a0a8e34bfa3e43ceb4ae18700000000000000001e6a1ced4b809b50411b57ea163d961b24191a2a943cd88310ba580cb7f3c84a2301000000000017a9145c6f176aa8bab82688c8b07562595a622d7b889a8700000000",
      "script": "6355b275a9144cc776751eb4d41f23feaf94697cb7ec2fe597a4882103c7b09d53bdb0ef9cfea06c1e6f2192e6a91cdeac209402bc36c1c368021a8611ac67a91453b9628e1e61cdd8339774d204938b3c45e95601882102a73443bc32f5fec6a551f71af75311b0876686156d16d367562d3d29987792d5ac68"
    },
    {
      "rawtx": "01000000010b8043159eaef778a082a2218022ef3787c66a9c718a6872b2c4a995a3801f1a0100000017a9145c6f176aa8bab82688c8b07562595a622d7b889a87ffffffff03463c00000000000017a91401a4bf455e24d4ecf25a26fecdfeb21d54ed7ecc8700000000000000001e6a1ced4b809b50411b57ea163d961b24191a2a943cd88310ba580cb7f3c94a2301000000000017a9145c6f176aa8bab82688c8b07562595a622d7b889a8700000000",
      "script": "6355b275a9144cc776751eb4d41f23feaf94697cb7ec2fe597a4882103c7b09d53bdb0ef9cfea06c1e6f2192e6a91cdeac209402bc36c1c368021a8611ac67a9141a88484594641881683185526b653e07760c3292882102a73443bc32f5fec6a551f71af75311b0876686156d16d367562d3d29987792d5ac68"
    },
    {
      "rawtx": "01000000010b8043159eaef778a082a2218022ef3787c66a9c718a6872b2c4a995a3801f1a0100000017a9145c6f176aa8bab82688c8b07562595a622d7b889a87ffffffff03463c00000000000017a91403de6328fe7485ce178674f1ba72f6f74bec54038700000000000000001e6a1ced4b809b50411b57ea163d961b24191a2a943cd88310ba580cb7f3ce4a2301000000000017a9145c6f176aa8bab82688c8b07562595a622d7b889a8700000000",
      "script": "6355b275a9144cc776751eb4d41f23feaf94697cb7ec2fe597a4882103c7b09d53bdb0ef9cfea06c1e6f2192e6a91cdeac209402bc36c1c368021a8611ac67a914dd5a0e7fd57fe2c7590d1b3337d0557d25e85855882102a73443bc32f5fec6a551f71af75311b0876686156d16d367562d3d29987792d5ac68"
    },
    {
      "rawtx": "01000000010b8043159eaef778a082a2218022ef3787c66a9c718a6872b2c4a995a3801f1a0100000017a9145c6f176aa8bab82688c8b07562595a622d7b889a87ffffffff03463c00000000000017a914fe69563e7a4f41b3b9dbcddaf284950043413d238700000000000000001e6a1ced4b809b50411b57ea163d961b24191a2a943cd88310ba580cb7f3cf4a2301000000000017a9145c6f176aa8bab82688c8b07562595a622d7b889a8700000000",
      "script": "6355b275a9144cc776751eb4d41f23feaf94697cb7ec2fe597a4882103c7b09d53bdb0ef9cfea06c1e6f2192e6a91cdeac209402bc36c1c368021a8611ac67a914aa53ac1db924e83b0fad63d1f1a437c5757dbda0882102a73443bc32f5fec6a551f71af75311b0876686156d16d367562d3d29987792d5ac68"
    },
    {
      "rawtx": "01000000010b8043159eaef778a082a2218022ef3787c66a9c718a6872b2c4a995a3801f1a0100000017a9145c6f176aa8bab82688c8b07562595a622d7b889a87ffffffff03463c00000000000017a914ec666f222631f5ef189753db52e9de22e05fbd628700000000000000001e6a1ced4b809b50411b57ea163d961b24191a2a943cd88310ba580cb7f3cc4a2301000000000017a9145c6f176aa8bab82688c8b07562595a622d7b889a8700000000",
      "script": "6355b275a9144cc776751eb4d41f23feaf94697cb7ec2fe597a4882103c7b09d53bdb0ef9cfea06c1e6f2192e6a91cdeac209402bc36c1c368021a8611ac67a914eaa0ebcf14d59cff2448aac33b13cc8d3901bf3b882102a73443bc32f5fec6a551f71af75311b0876686156d16d367562d3d29987792d5ac68"
    },
    {
      "rawtx": "01000000010b8043159eaef778a082a2218022ef3787c66a9c718a6872b2c4a995a3801f1a0100000017a9145c6f176aa8bab82688c8b07562595a622d7b889a87ffffffff03463c00000000000017a914814daf9c32feaa9431859b2b0812f8d72769ae698700000000000000001e6a1ced4b809b50411b57ea163d961b24191a2a943cd88310ba580cb7f3cd4a2301000000000017a9145c6f176aa8bab82688c8b07562595a622d7b889a8700000000",
      "script": "6355b275a9144cc776751eb4d41f23feaf94697cb7ec2fe597a4882103c7b09d53bdb0ef9cfea06c1e6f2192e6a91cdeac209402bc36c1c368021a8611ac67a914949b8c2408454b94e21e95f771ee3ae2ff20942d882102a73443bc32f5fec6a551f71af75311b0876686156d16d367562d3d29987792d5ac68"
    },
    {
      "rawtx": "01000000010b8043159eaef778a082a2218022ef3787c66a9c718a6872b2c4a995a3801f1a0100000017a9145c6f176aa8bab82688c8b07562595a622d7b889a87ffffffff03463c00000000000017a9140687c96575fb3d4c62a3306afd46362805ad90de8700000000000000001e6a1ced4b809b50411b57ea163d961b24191a2a943cd88310ba580cb7f3c24a2301000000000017a9145c6f176aa8bab82688c8b07562595a622d7b889a8700000000",
      "script": "6355b275a9144cc776751eb4d41f23feaf94697cb7ec2fe597a4882103c7b09d53bdb0ef9cfea06c1e6f2192e6a91cdeac209402bc36c1c368021a8611ac67a914174c5fd697b179b3c902974b71a7c964f41f4b57882102a73443bc32f5fec6a551f71af75311b0876686156d16d367562d3d29987792d5ac68"
    },
    {
      "rawtx": "01000000010b8043159eaef778a082a2218022ef3787c66a9c718a6872b2c4a995a3801f1a0100000017a9145c6f176aa8bab82688c8b07562595a622d7b889a87ffffffff03463c00000000000017a9147a64e5cf4fd8b650ae5cba26aae65775365f47118700000000000000001e6a1ced4b809b50411b57ea163d961b24191a2a943cd88310ba580cb7f3c34a2301000000000017a9145c6f176aa8bab82688c8b07562595a622d7b889a8700000000",
      "script": "6355b275a9144cc776751eb4d41f23feaf94697cb7ec2fe597a4882103c7b09d53bdb0ef9cfea06c1e6f2192e6a91cdeac209402bc36c1c368021a8611ac67a91444d6bb93cf5b2abd59854297b6857eb92179bdf8882102a73443bc32f5fec6a551f71af75311b0876686156d16d367562d3d29987792d5ac68"
    }
  ],
  "commits_revoked": [],
  "commits_requested": [],
  "deposit_script": "63522102a73443bc32f5fec6a551f71af75311b0876686156d16d367562d3d29987792d52103c7b09d53bdb0ef9cfea06c1e6f2192e6a91cdeac209402bc36c1c368021a861152ae6763a9144cc776751eb4d41f23feaf94697cb7ec2fe597a4882102a73443bc32f5fec6a551f71af75311b0876686156d16d367562d3d29987792d5ac6703ffff00b2752102a73443bc32f5fec6a551f71af75311b0876686156d16d367562d3d29987792d5ac6868",
  "asset": "A14456548018133352000"
}
STATE_AFTER = {
  "commits_active": [
    {
      "rawtx": "01000000010b8043159eaef778a082a2218022ef3787c66a9c718a6872b2c4a995a3801f1a0100000017a9145c6f176aa8bab82688c8b07562595a622d7b889a87ffffffff03463c00000000000017a914858db27f807e111eb6a100e7e8e5565b5acdd6998700000000000000001e6a1ced4b809b50411b57ea163d961b24191a2a943cd88310ba580cb7f3cb4a2301000000000017a9145c6f176aa8bab82688c8b07562595a622d7b889a8700000000",
      "script": "6355b275a9144cc776751eb4d41f23feaf94697cb7ec2fe597a4882103c7b09d53bdb0ef9cfea06c1e6f2192e6a91cdeac209402bc36c1c368021a8611ac67a914f05c03057c5161a619a1951847e68eb950d10aaf882102a73443bc32f5fec6a551f71af75311b0876686156d16d367562d3d29987792d5ac68"
    },
    {
      "rawtx": "01000000010b8043159eaef778a082a2218022ef3787c66a9c718a6872b2c4a995a3801f1a0100000017a9145c6f176aa8bab82688c8b07562595a622d7b889a87ffffffff03463c00000000000017a914b2fdeffd6e76586dbe8a0a8e34bfa3e43ceb4ae18700000000000000001e6a1ced4b809b50411b57ea163d961b24191a2a943cd88310ba580cb7f3c84a2301000000000017a9145c6f176aa8bab82688c8b07562595a622d7b889a8700000000",
      "script": "6355b275a9144cc776751eb4d41f23feaf94697cb7ec2fe597a4882103c7b09d53bdb0ef9cfea06c1e6f2192e6a91cdeac209402bc36c1c368021a8611ac67a91453b9628e1e61cdd8339774d204938b3c45e95601882102a73443bc32f5fec6a551f71af75311b0876686156d16d367562d3d29987792d5ac68"
    },
    {
      "rawtx": "01000000010b8043159eaef778a082a2218022ef3787c66a9c718a6872b2c4a995a3801f1a0100000017a9145c6f176aa8bab82688c8b07562595a622d7b889a87ffffffff03463c00000000000017a91401a4bf455e24d4ecf25a26fecdfeb21d54ed7ecc8700000000000000001e6a1ced4b809b50411b57ea163d961b24191a2a943cd88310ba580cb7f3c94a2301000000000017a9145c6f176aa8bab82688c8b07562595a622d7b889a8700000000",
      "script": "6355b275a9144cc776751eb4d41f23feaf94697cb7ec2fe597a4882103c7b09d53bdb0ef9cfea06c1e6f2192e6a91cdeac209402bc36c1c368021a8611ac67a9141a88484594641881683185526b653e07760c3292882102a73443bc32f5fec6a551f71af75311b0876686156d16d367562d3d29987792d5ac68"
    },
    {
      "rawtx": "01000000010b8043159eaef778a082a2218022ef3787c66a9c718a6872b2c4a995a3801f1a0100000017a9145c6f176aa8bab82688c8b07562595a622d7b889a87ffffffff03463c00000000000017a91403de6328fe7485ce178674f1ba72f6f74bec54038700000000000000001e6a1ced4b809b50411b57ea163d961b24191a2a943cd88310ba580cb7f3ce4a2301000000000017a9145c6f176aa8bab82688c8b07562595a622d7b889a8700000000",
      "script": "6355b275a9144cc776751eb4d41f23feaf94697cb7ec2fe597a4882103c7b09d53bdb0ef9cfea06c1e6f2192e6a91cdeac209402bc36c1c368021a8611ac67a914dd5a0e7fd57fe2c7590d1b3337d0557d25e85855882102a73443bc32f5fec6a551f71af75311b0876686156d16d367562d3d29987792d5ac68"
    }
  ],
  "commits_revoked": [
    {
      "revoke_secret": "ea2076a688a70f6198a7cf4d6787404ad4e5ea64d30ec4fec626efa0355402dc",
      "script": "6355b275a9144cc776751eb4d41f23feaf94697cb7ec2fe597a4882103c7b09d53bdb0ef9cfea06c1e6f2192e6a91cdeac209402bc36c1c368021a8611ac67a91444d6bb93cf5b2abd59854297b6857eb92179bdf8882102a73443bc32f5fec6a551f71af75311b0876686156d16d367562d3d29987792d5ac68"
    },
    {
      "revoke_secret": "79e8c6682057eb428d108bd9cfc789c6b4df7432553885e6614c0afa95a8fb3c",
      "script": "6355b275a9144cc776751eb4d41f23feaf94697cb7ec2fe597a4882103c7b09d53bdb0ef9cfea06c1e6f2192e6a91cdeac209402bc36c1c368021a8611ac67a914174c5fd697b179b3c902974b71a7c964f41f4b57882102a73443bc32f5fec6a551f71af75311b0876686156d16d367562d3d29987792d5ac68"
    },
    {
      "revoke_secret": "23dca672ce5b47c6efb245a453b634a443b0c9270bd3d857cb7d16dce6f04cc7",
      "script": "6355b275a9144cc776751eb4d41f23feaf94697cb7ec2fe597a4882103c7b09d53bdb0ef9cfea06c1e6f2192e6a91cdeac209402bc36c1c368021a8611ac67a914949b8c2408454b94e21e95f771ee3ae2ff20942d882102a73443bc32f5fec6a551f71af75311b0876686156d16d367562d3d29987792d5ac68"
    },
    {
      "revoke_secret": "b186cc0d480572d21d08c65389479c86811643f42ebb32d8c7b3135659a2e2b2",
      "script": "6355b275a9144cc776751eb4d41f23feaf94697cb7ec2fe597a4882103c7b09d53bdb0ef9cfea06c1e6f2192e6a91cdeac209402bc36c1c368021a8611ac67a914eaa0ebcf14d59cff2448aac33b13cc8d3901bf3b882102a73443bc32f5fec6a551f71af75311b0876686156d16d367562d3d29987792d5ac68"
    },
    {
      "revoke_secret": "3b7e393f044aba41dc3cb6bd277e64bfe941808e1b5ade352689348e51601751",
      "script": "6355b275a9144cc776751eb4d41f23feaf94697cb7ec2fe597a4882103c7b09d53bdb0ef9cfea06c1e6f2192e6a91cdeac209402bc36c1c368021a8611ac67a914aa53ac1db924e83b0fad63d1f1a437c5757dbda0882102a73443bc32f5fec6a551f71af75311b0876686156d16d367562d3d29987792d5ac68"
    }
  ],
  "commits_requested": [],
  "deposit_script": "63522102a73443bc32f5fec6a551f71af75311b0876686156d16d367562d3d29987792d52103c7b09d53bdb0ef9cfea06c1e6f2192e6a91cdeac209402bc36c1c368021a861152ae6763a9144cc776751eb4d41f23feaf94697cb7ec2fe597a4882102a73443bc32f5fec6a551f71af75311b0876686156d16d367562d3d29987792d5ac6703ffff00b2752102a73443bc32f5fec6a551f71af75311b0876686156d16d367562d3d29987792d5ac6868",
  "asset": "A14456548018133352000"
}


@pytest.mark.usefixtures("server_db")
@pytest.mark.usefixtures("api_server")
def test_standard_usage_xcp(server_db):

    state = util.api("mpc_revoke_all", {
        "state": STATE_BEFORE,
        "secrets": SECRETS,
    })

    assert state == STATE_AFTER


@pytest.mark.usefixtures("server_db")
@pytest.mark.usefixtures("api_server")
def test_standard_usage_btc(server_db):
    pass  # TODO test
