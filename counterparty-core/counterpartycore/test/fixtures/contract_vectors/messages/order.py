import binascii

from counterpartycore.lib import exceptions
from counterpartycore.test.fixtures.params import ADDR, DP, MULTISIGADDR, P2SH_ADDR

ORDER_VECTOR = {
    "order": {
        "validate": [
            {
                "in": (
                    ADDR[0],
                    "DIVISIBLE",
                    DP["quantity"],
                    "XCP",
                    DP["quantity"],
                    2000,
                    0,
                    DP["default_block_index"],
                ),
                "out": ([]),
            },
            {
                "in": (
                    P2SH_ADDR[0],
                    "DIVISIBLE",
                    DP["quantity"],
                    "XCP",
                    DP["quantity"],
                    2000,
                    0,
                    DP["default_block_index"],
                ),
                "out": ([]),
            },
            {
                "in": (
                    ADDR[0],
                    "DIVISIBLE",
                    DP["quantity"],
                    "XCP",
                    DP["quantity"],
                    2000,
                    0.5,
                    DP["default_block_index"],
                ),
                "out": (["fee_required must be in satoshis"]),
            },
            {
                "in": (
                    ADDR[0],
                    "BTC",
                    DP["quantity"],
                    "BTC",
                    DP["quantity"],
                    2000,
                    0,
                    DP["default_block_index"],
                ),
                "out": (["cannot trade BTC for itself"]),
            },
            {
                "in": (
                    ADDR[0],
                    "DIVISIBLE",
                    DP["quantity"] / 3,
                    "XCP",
                    DP["quantity"],
                    2000,
                    0,
                    DP["default_block_index"],
                ),
                "out": (["give_quantity must be in satoshis"]),
            },
            {
                "in": (
                    ADDR[0],
                    "DIVISIBLE",
                    DP["quantity"],
                    "XCP",
                    DP["quantity"] / 3,
                    2000,
                    0,
                    DP["default_block_index"],
                ),
                "out": (["get_quantity must be in satoshis"]),
            },
            {
                "in": (
                    ADDR[0],
                    "DIVISIBLE",
                    DP["quantity"],
                    "XCP",
                    DP["quantity"],
                    1.5,
                    0,
                    DP["default_block_index"],
                ),
                "out": (["expiration must be expressed as an integer block delta"]),
            },
            {
                "in": (
                    ADDR[0],
                    "DIVISIBLE",
                    -DP["quantity"],
                    "XCP",
                    -DP["quantity"],
                    -2000,
                    -10000,
                    DP["default_block_index"],
                ),
                "out": (
                    [
                        "non‐positive give quantity",
                        "non‐positive get quantity",
                        "negative fee_required",
                        "negative expiration",
                    ]
                ),
            },
            {
                "in": (
                    ADDR[0],
                    "DIVISIBLE",
                    0,
                    "XCP",
                    DP["quantity"],
                    2000,
                    0,
                    DP["default_block_index"],
                ),
                "out": (["non‐positive give quantity", "zero give or zero get"]),
            },
            {
                "in": (
                    ADDR[0],
                    "NOASSETA",
                    DP["quantity"],
                    "NOASSETB",
                    DP["quantity"],
                    2000,
                    0,
                    DP["default_block_index"],
                ),
                "out": (["no such asset to give (NOASSETA)", "no such asset to get (NOASSETB)"]),
            },
            {
                "in": (
                    ADDR[0],
                    "DIVISIBLE",
                    2**63 + 10,
                    "XCP",
                    DP["quantity"],
                    4 * 2016 + 10,
                    0,
                    DP["default_block_index"],
                ),
                "out": (["integer overflow", "expiration overflow"]),
            },
        ],
        "compose": [
            {
                "in": (
                    ADDR[0],
                    "BTC",
                    DP["small"],
                    "XCP",
                    DP["small"] * 2,
                    DP["expiration"],
                    0,
                ),
                "out": (
                    "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                    [],
                    b"\x00\x00\x00\n\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\xfa\xf0\x80\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x05\xf5\xe1\x00\x00\n\x00\x00\x00\x00\x00\x00\x00\x00",
                ),
            },
            {
                "in": (
                    P2SH_ADDR[0],
                    "BTC",
                    DP["small"],
                    "XCP",
                    DP["small"] * 2,
                    DP["expiration"],
                    0,
                ),
                "out": (
                    P2SH_ADDR[0],
                    [],
                    b"\x00\x00\x00\n\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\xfa\xf0\x80\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x05\xf5\xe1\x00\x00\n\x00\x00\x00\x00\x00\x00\x00\x00",
                ),
            },
            {
                "in": (
                    ADDR[0],
                    "XCP",
                    round(DP["small"] * 2.1),
                    "BTC",
                    DP["small"],
                    DP["expiration"],
                    DP["fee_required"],
                ),
                "out": (
                    "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                    [],
                    b"\x00\x00\x00\n\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x06B,@\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\xfa\xf0\x80\x00\n\x00\x00\x00\x00\x00\r\xbb\xa0",
                ),
            },
            {
                "in": (
                    MULTISIGADDR[0],
                    "BTC",
                    DP["small"],
                    "XCP",
                    DP["small"] * 2,
                    DP["expiration"],
                    0,
                ),
                "out": (
                    "1_mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc_mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns_2",
                    [],
                    b"\x00\x00\x00\n\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\xfa\xf0\x80\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x05\xf5\xe1\x00\x00\n\x00\x00\x00\x00\x00\x00\x00\x00",
                ),
            },
            {
                "in": (
                    MULTISIGADDR[0],
                    "XCP",
                    round(DP["small"] * 2.1),
                    "BTC",
                    DP["small"],
                    DP["expiration"],
                    DP["fee_required"],
                ),
                "out": (
                    "1_mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc_mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns_2",
                    [],
                    b"\x00\x00\x00\n\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x06B,@\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\xfa\xf0\x80\x00\n\x00\x00\x00\x00\x00\r\xbb\xa0",
                ),
            },
            {
                "in": (
                    ADDR[0],
                    "MAXI",
                    2**63 - 1,
                    "XCP",
                    DP["quantity"],
                    DP["expiration"],
                    DP["fee_required"],
                ),
                "out": (
                    "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                    [],
                    b"\x00\x00\x00\n\x00\x00\x00\x00\x00\x03:>\x7f\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x05\xf5\xe1\x00\x00\n\x00\x00\x00\x00\x00\r\xbb\xa0",
                ),
            },
            {
                "in": (
                    ADDR[0],
                    "MAXI",
                    2**63 - 1,
                    "XCP",
                    DP["quantity"],
                    DP["expiration"],
                    2**63,
                ),
                "error": (exceptions.ComposeError, ["integer overflow"]),
            },
            {
                "in": (
                    ADDR[0],
                    "MAXI",
                    2**63,
                    "XCP",
                    DP["quantity"],
                    DP["expiration"],
                    DP["fee_required"],
                ),
                "error": (exceptions.ComposeError, "insufficient funds"),
            },
            {
                "comment": "give subasset",
                "in": (
                    ADDR[0],
                    "PARENT.already.issued",
                    100000000,
                    "XCP",
                    DP["small"],
                    DP["expiration"],
                    DP["fee_required"],
                ),
                "out": (
                    "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                    [],
                    binascii.unhexlify(
                        "0000000a01530821671b10650000000005f5e10000000000000000010000000002faf080000a00000000000dbba0"
                    ),
                ),
            },
            {
                "comment": "get subasset",
                "in": (
                    ADDR[0],
                    "XCP",
                    DP["small"],
                    "PARENT.already.issued",
                    100000000,
                    DP["expiration"],
                    DP["fee_required"],
                ),
                "out": (
                    "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                    [],
                    binascii.unhexlify(
                        "0000000a00000000000000010000000002faf08001530821671b10650000000005f5e100000a00000000000dbba0"
                    ),
                ),
            },
        ],
        "parse": [
            {
                "comment": "order 1",
                "in": (
                    {
                        "destination": None,
                        "tx_hash": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                        "source": "mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns",
                        "block_time": 155409000,
                        "block_index": DP["default_block_index"],
                        "tx_index": DP["default_tx_index"],
                        "data": b"\x00\x00\x00\n\x00\x00\x00\xa2[\xe3Kf\x00\x00\x00\x00\x05\xf5\xe1\x00\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x05\xf5\xe1\x00\x07\xd0\x00\x00\x00\x00\x00\x00\x00\x00",
                        "fee": 10000,
                        "btc_amount": None,
                        "supported": 1,
                        "block_hash": DP["default_block_hash"],
                    },
                ),
                "records": [
                    {
                        "table": "orders",
                        "values": {
                            "block_index": DP["default_block_index"],
                            "expiration": 2000,
                            "expire_index": DP["default_block_index"] + 2000,
                            "fee_provided": 10000,
                            "fee_provided_remaining": 10000,
                            "fee_required": 0,
                            "fee_required_remaining": 0,
                            "get_asset": "XCP",
                            "get_quantity": 100000000,
                            "get_remaining": 0,
                            "give_asset": "DIVISIBLE",
                            "give_quantity": 100000000,
                            "give_remaining": 0,
                            "source": "mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns",
                            "status": "filled",
                            "tx_hash": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "tx_index": DP["default_tx_index"],
                        },
                    },
                    {
                        "table": "order_matches",
                        "values": {
                            "backward_asset": "DIVISIBLE",
                            "backward_quantity": 100000000,
                            "block_index": DP["default_block_index"],
                            "fee_paid": 0,
                            "forward_asset": "XCP",
                            "forward_quantity": 100000000,
                            "id": "e7038bdcd8fe79d282000f04123f98549c7abb40163fc9580b02486b4c1a55cf_db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "match_expire_index": DP["default_block_index"] + 20,
                            "status": "completed",
                            "tx0_address": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "tx0_block_index": 310006,
                            "tx0_expiration": 2000,
                            "tx0_hash": "e7038bdcd8fe79d282000f04123f98549c7abb40163fc9580b02486b4c1a55cf",
                            "tx0_index": 7,
                            "tx1_address": "mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns",
                            "tx1_block_index": DP["default_block_index"],
                            "tx1_expiration": 2000,
                            "tx1_hash": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "tx1_index": DP["default_tx_index"],
                        },
                    },
                    {
                        "table": "credits",
                        "values": {
                            "address": "mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns",
                            "asset": "XCP",
                            "block_index": DP["default_block_index"],
                            "calling_function": "order match",
                            "event": "e7038bdcd8fe79d282000f04123f98549c7abb40163fc9580b02486b4c1a55cf_db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "quantity": 100000000,
                        },
                    },
                    {
                        "table": "debits",
                        "values": {
                            "action": "open order",
                            "address": "mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns",
                            "asset": "DIVISIBLE",
                            "block_index": DP["default_block_index"],
                            "event": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "quantity": 100000000,
                        },
                    },
                    {
                        "table": "credits",
                        "values": {
                            "address": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "asset": "DIVISIBLE",
                            "block_index": DP["default_block_index"],
                            "calling_function": "order match",
                            "event": "e7038bdcd8fe79d282000f04123f98549c7abb40163fc9580b02486b4c1a55cf_db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "quantity": 100000000,
                        },
                    },
                    {
                        "table": "credits",
                        "values": {
                            "address": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "asset": "XCP",
                            "block_index": DP["default_block_index"],
                            "calling_function": "filled",
                            "event": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "quantity": 0,
                        },
                    },
                    {
                        "table": "credits",
                        "values": {
                            "address": "mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns",
                            "asset": "DIVISIBLE",
                            "block_index": DP["default_block_index"],
                            "calling_function": "filled",
                            "event": "e7038bdcd8fe79d282000f04123f98549c7abb40163fc9580b02486b4c1a55cf",
                            "quantity": 0,
                        },
                    },
                ],
            },
            {
                "comment": "P2SH order",
                "in": (
                    {
                        "block_hash": "2d62095b10a709084b1854b262de77cb9f4f7cd76ba569657df8803990ffbfc6c12bca3c18a44edae9498e1f0f054072e16eef32dfa5e3dd4be149009115b4b8",
                        "block_index": DP["default_block_index"],
                        "block_time": 155409000,
                        "btc_amount": None,
                        "data": b"\x00\x00\x00\n\x00\x00\x00\xa2[\xe3Kf\x00\x00\x00\x00\x05\xf5\xe1\x00\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x05\xf5\xe1\x00\x07\xd0\x00\x00\x00\x00\x00\x00\x00\x00",
                        "destination": None,
                        "fee": 10000,
                        "source": P2SH_ADDR[0],
                        "supported": 1,
                        "tx_hash": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                        "tx_index": DP["default_tx_index"],
                    },
                ),
                "records": [
                    {
                        "table": "orders",
                        "values": {
                            "block_index": DP["default_block_index"],
                            "expiration": 2000,
                            "expire_index": DP["default_block_index"] + 2000,
                            "fee_provided": 10000,
                            "fee_provided_remaining": 10000,
                            "fee_required": 0,
                            "fee_required_remaining": 0,
                            "get_asset": "XCP",
                            "get_quantity": 100000000,
                            "get_remaining": 0,
                            "give_asset": "DIVISIBLE",
                            "give_quantity": 100000000,
                            "give_remaining": 0,
                            "source": P2SH_ADDR[0],
                            "status": "filled",
                            "tx_hash": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "tx_index": DP["default_tx_index"],
                        },
                    },
                    {
                        "table": "order_matches",
                        "values": {
                            "backward_asset": "DIVISIBLE",
                            "backward_quantity": 100000000,
                            "block_index": DP["default_block_index"],
                            "fee_paid": 0,
                            "forward_asset": "XCP",
                            "forward_quantity": 100000000,
                            "id": "e7038bdcd8fe79d282000f04123f98549c7abb40163fc9580b02486b4c1a55cf_db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "match_expire_index": DP["default_block_index"] + 20,
                            "status": "completed",
                            "tx0_address": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "tx0_block_index": 310006,
                            "tx0_expiration": 2000,
                            "tx0_hash": "e7038bdcd8fe79d282000f04123f98549c7abb40163fc9580b02486b4c1a55cf",
                            "tx0_index": 7,
                            "tx1_address": P2SH_ADDR[0],
                            "tx1_block_index": DP["default_block_index"],
                            "tx1_expiration": 2000,
                            "tx1_hash": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "tx1_index": DP["default_tx_index"],
                        },
                    },
                    {
                        "table": "credits",
                        "values": {
                            "address": P2SH_ADDR[0],
                            "asset": "XCP",
                            "block_index": DP["default_block_index"],
                            "calling_function": "order match",
                            "event": "e7038bdcd8fe79d282000f04123f98549c7abb40163fc9580b02486b4c1a55cf_db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "quantity": 100000000,
                        },
                    },
                    {
                        "table": "debits",
                        "values": {
                            "action": "open order",
                            "address": P2SH_ADDR[0],
                            "asset": "DIVISIBLE",
                            "block_index": DP["default_block_index"],
                            "event": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "quantity": 100000000,
                        },
                    },
                    {
                        "table": "credits",
                        "values": {
                            "address": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "asset": "DIVISIBLE",
                            "block_index": DP["default_block_index"],
                            "calling_function": "order match",
                            "event": "e7038bdcd8fe79d282000f04123f98549c7abb40163fc9580b02486b4c1a55cf_db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "quantity": 100000000,
                        },
                    },
                    {
                        "table": "credits",
                        "values": {
                            "address": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "asset": "XCP",
                            "block_index": DP["default_block_index"],
                            "calling_function": "filled",
                            "event": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "quantity": 0,
                        },
                    },
                    {
                        "table": "credits",
                        "values": {
                            "address": P2SH_ADDR[0],
                            "asset": "DIVISIBLE",
                            "block_index": DP["default_block_index"],
                            "calling_function": "filled",
                            "event": "e7038bdcd8fe79d282000f04123f98549c7abb40163fc9580b02486b4c1a55cf",
                            "quantity": 0,
                        },
                    },
                ],
            },
            {
                "comment": "order 2",
                "in": (
                    {
                        "block_hash": "2d62095b10a709084b1854b262de77cb9f4f7cd76ba569657df8803990ffbfc6c12bca3c18a44edae9498e1f0f054072e16eef32dfa5e3dd4be149009115b4b8",
                        "btc_amount": None,
                        "tx_index": DP["default_tx_index"],
                        "supported": 1,
                        "source": "mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns",
                        "fee": 10000,
                        "block_time": 155409000,
                        "block_index": DP["default_block_index"],
                        "tx_hash": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                        "data": b"\x00\x00\x00\n\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0fB@\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x05\xf5\xe1\x00\x07\xd0\x00\x00\x00\x00\x00\x00\x00\x00",
                        "destination": None,
                    },
                ),
                "records": [
                    {
                        "table": "orders",
                        "values": {
                            "block_index": DP["default_block_index"],
                            "expiration": 2000,
                            "expire_index": DP["default_block_index"] + 2000,
                            "fee_provided": 10000,
                            "fee_provided_remaining": 1000,
                            "fee_required": 0,
                            "fee_required_remaining": 0,
                            "get_asset": "XCP",
                            "get_quantity": 100000000,
                            "get_remaining": -20000000,
                            "give_asset": "BTC",
                            "give_quantity": 1000000,
                            "give_remaining": 0,
                            "source": "mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns",
                            "status": "open",
                            "tx_hash": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "tx_index": DP["default_tx_index"],
                        },
                    },
                    {
                        "table": "order_matches",
                        "values": {
                            "backward_asset": "BTC",
                            "backward_quantity": 200000,
                            "block_index": DP["default_block_index"],
                            "fee_paid": 1800,
                            "forward_asset": "XCP",
                            "forward_quantity": 20000000,
                            "id": "b6c0ce5991e1ab4b46cdd25f612cda202d123872c6250831bc0f510a90c1238e_db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "match_expire_index": DP["default_block_index"] + 20,
                            "status": "pending",
                            "tx0_address": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "tx0_block_index": 310010,
                            "tx0_expiration": 2000,
                            "tx0_hash": "b6c0ce5991e1ab4b46cdd25f612cda202d123872c6250831bc0f510a90c1238e",
                            "tx0_index": 11,
                            "tx1_address": "mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns",
                            "tx1_block_index": DP["default_block_index"],
                            "tx1_expiration": 2000,
                            "tx1_hash": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "tx1_index": DP["default_tx_index"],
                        },
                    },
                ],
            },
            {
                "comment": "order 2bis",
                "in": (
                    {
                        "fee": 10000,
                        "block_time": 155409000,
                        "tx_hash": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                        "source": "mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns",
                        "destination": None,
                        "supported": 1,
                        "tx_index": DP["default_tx_index"],
                        "data": b"\x00\x00\x00\n\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x05\xf5\xe1\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\n,+\x07\xd0\x00\x00\x00\x00\x00\x00\x00\x00",
                        "block_hash": DP["default_block_hash"],
                        "btc_amount": None,
                        "block_index": DP["default_block_index"],
                    },
                ),
                "records": [
                    {
                        "table": "orders",
                        "values": {
                            "block_index": DP["default_block_index"],
                            "expiration": 2000,
                            "expire_index": DP["default_block_index"] + 2000,
                            "fee_provided": 10000,
                            "fee_provided_remaining": 10000,
                            "fee_required": 0,
                            "fee_required_remaining": 0,
                            "get_asset": "BTC",
                            "get_quantity": 666666,
                            "get_remaining": -133333,
                            "give_asset": "XCP",
                            "give_quantity": 99999990,
                            "give_remaining": 115,
                            "source": "mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns",
                            "status": "open",
                            "tx_hash": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "tx_index": DP["default_tx_index"],
                        },
                    },
                    {
                        "table": "order_matches",
                        "values": {
                            "backward_asset": "XCP",
                            "backward_quantity": 99999875,
                            "block_index": DP["default_block_index"],
                            "fee_paid": 0,
                            "forward_asset": "BTC",
                            "forward_quantity": 799999,
                            "id": "05bcc7b25130206aca1f3b695e4d9ed392c9f16c0294ab292c0a029c1bb5e4ca_db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "match_expire_index": DP["default_block_index"] + 20,
                            "status": "pending",
                            "tx0_address": "mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns",
                            "tx0_block_index": 310513,
                            "tx0_expiration": 2000,
                            "tx0_hash": "05bcc7b25130206aca1f3b695e4d9ed392c9f16c0294ab292c0a029c1bb5e4ca",
                            "tx0_index": 493,
                            "tx1_address": "mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns",
                            "tx1_block_index": DP["default_block_index"],
                            "tx1_expiration": 2000,
                            "tx1_hash": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "tx1_index": DP["default_tx_index"],
                        },
                    },
                    {
                        "table": "debits",
                        "values": {
                            "action": "open order",
                            "address": "mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns",
                            "asset": "XCP",
                            "block_index": DP["default_block_index"],
                            "event": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "quantity": 99999990,
                        },
                    },
                ],
            },
            {
                "comment": "order 3",
                "in": (
                    {
                        "block_time": 155409000,
                        "destination": None,
                        "btc_amount": None,
                        "tx_hash": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                        "data": b"\x00\x00\x00\n\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x05\xf5\xe1\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x1e\x84\x80\x07\xd0\x00\x00\x00\x00\x00\x00\x00\x00",
                        "supported": 1,
                        "fee": 10000,
                        "source": "mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns",
                        "tx_index": DP["default_tx_index"],
                        "block_index": DP["default_block_index"],
                        "block_hash": "2d62095b10a709084b1854b262de77cb9f4f7cd76ba569657df8803990ffbfc6c12bca3c18a44edae9498e1f0f054072e16eef32dfa5e3dd4be149009115b4b8",
                    },
                ),
                "records": [
                    {
                        "table": "orders",
                        "values": {
                            "block_index": DP["default_block_index"],
                            "expiration": 2000,
                            "expire_index": DP["default_block_index"] + 2000,
                            "fee_provided": 10000,
                            "fee_provided_remaining": 10000,
                            "fee_required": 0,
                            "fee_required_remaining": 0,
                            "get_asset": "BTC",
                            "get_quantity": 1999999,
                            "get_remaining": 1999999,
                            "give_asset": "XCP",
                            "give_quantity": 99999990,
                            "give_remaining": 99999990,
                            "source": "mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns",
                            "status": "open",
                            "tx_hash": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "tx_index": DP["default_tx_index"],
                        },
                    },
                    {
                        "table": "debits",
                        "values": {
                            "action": "open order",
                            "address": "mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns",
                            "asset": "XCP",
                            "block_index": DP["default_block_index"],
                            "event": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "quantity": 99999990,
                        },
                    },
                ],
            },
            {
                "comment": "5",
                "in": (
                    {
                        "data": b"\x00\x00\x00\n\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x07\xa1 \x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x05\xf5\xe1\x00\x07\xd0\x00\x00\x00\x00\x00\x00\x00\x00",
                        "tx_index": DP["default_tx_index"],
                        "destination": None,
                        "block_index": DP["default_block_index"],
                        "tx_hash": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                        "btc_amount": None,
                        "block_time": 155409000,
                        "supported": 1,
                        "fee": 1000000,
                        "block_hash": DP["default_block_hash"],
                        "source": "mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns",
                    },
                ),
                "records": [
                    {
                        "table": "orders",
                        "values": {
                            "block_index": DP["default_block_index"],
                            "expiration": 2000,
                            "expire_index": DP["default_block_index"] + 2000,
                            "fee_provided": 1000000,
                            "fee_provided_remaining": 1000000,
                            "fee_required": 0,
                            "fee_required_remaining": 0,
                            "get_asset": "XCP",
                            "get_quantity": 100000000,
                            "get_remaining": 100000000,
                            "give_asset": "BTC",
                            "give_quantity": 500000,
                            "give_remaining": 500000,
                            "source": "mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns",
                            "status": "open",
                            "tx_hash": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "tx_index": DP["default_tx_index"],
                        },
                    }
                ],
            },
            {
                "comment": "order 4",
                "in": (
                    {
                        "block_hash": "2d62095b10a709084b1854b262de77cb9f4f7cd76ba569657df8803990ffbfc6c12bca3c18a44edae9498e1f0f054072e16eef32dfa5e3dd4be149009115b4b8",
                        "btc_amount": None,
                        "tx_index": DP["default_tx_index"],
                        "supported": 1,
                        "source": "mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns",
                        "fee": 10000,
                        "block_time": 155409000,
                        "block_index": DP["default_block_index"],
                        "tx_hash": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                        "data": b"\x00\x00\x00\n\x00\x00\x00\x00\x00 foo\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xe1\x00\x07\xd0\x00\x00\x00\x00\x00\x00\x00\x00",
                        "destination": None,
                    },
                ),
                "records": [
                    {
                        "table": "orders",
                        "values": {
                            "block_index": DP["default_block_index"],
                            "expiration": 0,
                            "expire_index": DP["default_block_index"],
                            "fee_provided": 10000,
                            "fee_provided_remaining": 10000,
                            "fee_required": 0,
                            "fee_required_remaining": 0,
                            "get_asset": "0",
                            "get_quantity": 0,
                            "get_remaining": 0,
                            "give_asset": "0",
                            "give_quantity": 0,
                            "give_remaining": 0,
                            "source": "mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns",
                            "status": "invalid: could not unpack",
                            "tx_hash": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "tx_index": DP["default_tx_index"],
                        },
                    },
                ],
            },
            {
                "comment": "7",
                "in": (
                    {
                        "btc_amount": None,
                        "block_time": 155409000,
                        "tx_hash": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                        "tx_index": DP["default_tx_index"],
                        "supported": 1,
                        "source": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                        "block_hash": DP["default_block_hash"],
                        "destination": None,
                        "block_index": DP["default_block_index"],
                        "data": b"\x00\x00\x00\n\x00\x06\xca\xd8\xdc\x7f\x0bf\x00\x00\x00\x00\x00\x00\x01\xf4\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x05\xf5\xe1\x00\x07\xd0\x00\x00\x00\x00\x00\x00\x00\x00",
                        "fee": 10000,
                    },
                ),
                "records": [
                    {
                        "table": "orders",
                        "values": {
                            "block_index": DP["default_block_index"],
                            "expiration": 2000,
                            "expire_index": DP["default_block_index"] + 2000,
                            "fee_provided": 10000,
                            "fee_provided_remaining": 10000,
                            "fee_required": 0,
                            "fee_required_remaining": 0,
                            "get_asset": "XCP",
                            "get_quantity": 100000000,
                            "get_remaining": 100000000,
                            "give_asset": "NODIVISIBLE",
                            "give_quantity": 500,
                            "give_remaining": 500,
                            "source": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "status": "open",
                            "tx_hash": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "tx_index": DP["default_tx_index"],
                        },
                    },
                    {
                        "table": "debits",
                        "values": {
                            "action": "open order",
                            "address": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "asset": "NODIVISIBLE",
                            "block_index": DP["default_block_index"],
                            "event": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "quantity": 500,
                        },
                    },
                ],
            },
            {
                "comment": "order 5",
                "in": (
                    {
                        "block_index": DP["default_block_index"],
                        "data": b"\x00\x00\x00\n\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\xfa\xf0\x80\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x05\xf5\xe1\x00\x00\n\x00\x00\x00\x00\x00\x00\x00\x00",
                        "tx_hash": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                        "block_hash": "2d62095b10a709084b1854b262de77cb9f4f7cd76ba569657df8803990ffbfc6c12bca3c18a44edae9498e1f0f054072e16eef32dfa5e3dd4be149009115b4b8",
                        "destination": "",
                        "fee": 10000,
                        "tx_index": DP["default_tx_index"],
                        "supported": 1,
                        "source": "1_mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc_mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns_2",
                        "block_time": 155409000,
                        "btc_amount": 0,
                    },
                ),
                "records": [
                    {
                        "table": "orders",
                        "values": {
                            "block_index": DP["default_block_index"],
                            "expiration": 10,
                            "expire_index": DP["default_block_index"] + 10,
                            "fee_provided": 10000,
                            "fee_provided_remaining": 2800,
                            "fee_required": 0,
                            "fee_required_remaining": 0,
                            "get_asset": "XCP",
                            "get_quantity": 100000000,
                            "get_remaining": 0,
                            "give_asset": "BTC",
                            "give_quantity": 50000000,
                            "give_remaining": 49200000,
                            "source": "1_mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc_mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns_2",
                            "status": "open",
                            "tx_hash": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "tx_index": DP["default_tx_index"],
                        },
                    },
                    {
                        "table": "order_matches",
                        "values": {
                            "backward_asset": "BTC",
                            "backward_quantity": 800000,
                            "block_index": DP["default_block_index"],
                            "fee_paid": 7200,
                            "forward_asset": "XCP",
                            "forward_quantity": 100000000,
                            "id": "65e649d58b95602b04172375dbd86783b7379e455a2bc801338d9299d10425a5_db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "match_expire_index": DP["default_block_index"] + 20,
                            "status": "pending",
                            "tx0_address": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "tx0_block_index": 310513,
                            "tx0_expiration": 2000,
                            "tx0_hash": "65e649d58b95602b04172375dbd86783b7379e455a2bc801338d9299d10425a5",
                            "tx0_index": 492,
                            "tx1_address": "1_mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc_mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns_2",
                            "tx1_block_index": DP["default_block_index"],
                            "tx1_expiration": 10,
                            "tx1_hash": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "tx1_index": DP["default_tx_index"],
                        },
                    },
                ],
            },
            {
                "comment": "order 6",
                "in": (
                    {
                        "block_index": DP["default_block_index"],
                        "data": b"\x00\x00\x00\n\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\xfa\xf0\x80\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x05\xf5\xe1\x00\x00\n\x00\x00\x00\x00\x00\x00\x00\x00",
                        "tx_hash": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                        "block_hash": "2d62095b10a709084b1854b262de77cb9f4f7cd76ba569657df8803990ffbfc6c12bca3c18a44edae9498e1f0f054072e16eef32dfa5e3dd4be149009115b4b8",
                        "destination": "",
                        "fee": 10000,
                        "tx_index": DP["default_tx_index"],
                        "supported": 1,
                        "source": "1_mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc_mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns_2",
                        "block_time": 155409000,
                        "btc_amount": 0,
                    },
                ),
                "records": [
                    {
                        "table": "orders",
                        "values": {
                            "block_index": DP["default_block_index"],
                            "expiration": 10,
                            "expire_index": DP["default_block_index"] + 10,
                            "fee_provided": 10000,
                            "fee_provided_remaining": 2800,
                            "fee_required": 0,
                            "fee_required_remaining": 0,
                            "get_asset": "XCP",
                            "get_quantity": 100000000,
                            "get_remaining": 0,
                            "give_asset": "BTC",
                            "give_quantity": 50000000,
                            "give_remaining": 49200000,
                            "source": "1_mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc_mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns_2",
                            "status": "open",
                            "tx_hash": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "tx_index": DP["default_tx_index"],
                        },
                    },
                    {
                        "table": "order_matches",
                        "values": {
                            "backward_asset": "BTC",
                            "backward_quantity": 800000,
                            "block_index": DP["default_block_index"],
                            "fee_paid": 7200,
                            "forward_asset": "XCP",
                            "forward_quantity": 100000000,
                            "id": "65e649d58b95602b04172375dbd86783b7379e455a2bc801338d9299d10425a5_db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "match_expire_index": DP["default_block_index"] + 20,
                            "status": "pending",
                            "tx0_address": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "tx0_block_index": 310513,
                            "tx0_expiration": 2000,
                            "tx0_hash": "65e649d58b95602b04172375dbd86783b7379e455a2bc801338d9299d10425a5",
                            "tx0_index": 492,
                            "tx1_address": "1_mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc_mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns_2",
                            "tx1_block_index": DP["default_block_index"],
                            "tx1_expiration": 10,
                            "tx1_hash": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "tx1_index": DP["default_tx_index"],
                        },
                    },
                ],
            },
            {
                "comment": "order 7",
                "in": (
                    {
                        "fee": 10000,
                        "btc_amount": 0,
                        "tx_hash": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                        "tx_index": DP["default_tx_index"],
                        "block_hash": "2d62095b10a709084b1854b262de77cb9f4f7cd76ba569657df8803990ffbfc6c12bca3c18a44edae9498e1f0f054072e16eef32dfa5e3dd4be149009115b4b8",
                        "source": "1_mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc_mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns_2",
                        "supported": 1,
                        "block_time": 155409000,
                        "block_index": DP["default_block_index"],
                        "data": b"\x00\x00\x00\n\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x06B,@\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\xfa\xf0\x80\x00\n\x00\x00\x00\x00\x00\r\xbb\xa0",
                        "destination": "",
                    },
                ),
                "records": [
                    {
                        "table": "orders",
                        "values": {
                            "block_index": DP["default_block_index"],
                            "expire_index": DP["default_block_index"] + 10,
                            "fee_provided": 10000,
                            "fee_provided_remaining": 10000,
                            "fee_required": 900000,
                            "fee_required_remaining": 900000,
                            "get_asset": "BTC",
                            "get_quantity": 50000000,
                            "get_remaining": 50000000,
                            "give_asset": "XCP",
                            "give_quantity": 105000000,
                            "give_remaining": 105000000,
                            "source": "1_mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc_mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns_2",
                            "status": "open",
                            "tx_hash": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "tx_index": DP["default_tx_index"],
                            "expiration": 10,
                        },
                    },
                    {
                        "table": "debits",
                        "values": {
                            "action": "open order",
                            "address": "1_mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc_mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns_2",
                            "asset": "XCP",
                            "quantity": 105000000,
                            "block_index": DP["default_block_index"],
                            "event": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                        },
                    },
                ],
            },
            {
                "comment": "order 8",
                "in": (
                    {
                        "btc_amount": 0,
                        "fee": 10000,
                        "source": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                        "destination": "",
                        "tx_hash": "0ec7da68a67e165693afd6c97566f8f509d302bceec8d1be0100335718a40fe5",
                        "tx_index": DP["default_tx_index"],
                        "data": b"\x00\x00\x00\n\x00\x00\x00\x00\x00\x03:>\x7f\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x05\xf5\xe1\x00\x00\n\x00\x00\x00\x00\x00\r\xbb\xa0",
                        "block_hash": "2d62095b10a709084b1854b262de77cb9f4f7cd76ba569657df8803990ffbfc6c12bca3c18a44edae9498e1f0f054072e16eef32dfa5e3dd4be149009115b4b8",
                        "supported": 1,
                        "block_time": 155409000,
                        "block_index": DP["default_block_index"],
                    },
                ),
                "records": [
                    {
                        "table": "orders",
                        "values": {
                            "block_index": DP["default_block_index"],
                            "expiration": 10,
                            "expire_index": DP["default_block_index"] + 10,
                            "fee_provided": 10000,
                            "fee_provided_remaining": 10000,
                            "fee_required": 900000,
                            "fee_required_remaining": 900000,
                            "get_asset": "XCP",
                            "get_quantity": 100000000,
                            "get_remaining": 100000000,
                            "give_asset": "MAXI",
                            "give_quantity": 9223372036854775807,
                            "give_remaining": 9223372036854775807,
                            "source": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "status": "open",
                            "tx_hash": "0ec7da68a67e165693afd6c97566f8f509d302bceec8d1be0100335718a40fe5",
                            "tx_index": DP["default_tx_index"],
                        },
                    },
                    {
                        "table": "debits",
                        "values": {
                            "action": "open order",
                            "address": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "asset": "MAXI",
                            "block_index": DP["default_block_index"],
                            "event": "0ec7da68a67e165693afd6c97566f8f509d302bceec8d1be0100335718a40fe5",
                            "quantity": 9223372036854775807,
                        },
                    },
                ],
            },
            {
                "comment": "order shouldn't be inserted because fee_required is > MAX_INT",
                "in": (
                    {
                        "btc_amount": 0,
                        "fee": 10000,
                        "source": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                        "destination": "",
                        "tx_hash": "0ec7da68a67e165693afd6c97566f8f509d302bceec8d1be0100335718a40fe5",
                        "tx_index": DP["default_tx_index"],
                        "data": b"\x00\x00\x00\n\x00\x00\x00\x00\x00\x03:>\x7f\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x05\xf5\xe1\x00\x00\n\x80\x00\x00\x00\x00\x00\x00\x00",
                        "block_hash": "2d62095b10a709084b1854b262de77cb9f4f7cd76ba569657df8803990ffbfc6c12bca3c18a44edae9498e1f0f054072e16eef32dfa5e3dd4be149009115b4b8",
                        "supported": 1,
                        "block_time": 155409000,
                        "block_index": DP["default_block_index"],
                    },
                ),
                "records": [
                    {
                        "not": True,  # NOT
                        "table": "orders",
                        "values": {
                            "tx_hash": "0ec7da68a67e165693afd6c97566f8f509d302bceec8d1be0100335718a40fe5"
                        },
                    },
                ],
            },
        ],
        "expire": [{"in": (DP["default_block_index"] - 1,), "out": None}],
    },
}
