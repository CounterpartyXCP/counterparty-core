import binascii

from counterpartycore.lib import exceptions
from counterpartycore.lib.messages import issuance
from counterpartycore.test.fixtures.params import ADDR, DP, MULTISIGADDR, P2SH_ADDR

ISSUANCE_VECTOR = {
    "issuance": {
        # validate (db, source, destination, asset, quantity, divisible, lock, reset, callable_, call_date, call_price, description, subasset_parent, subasset_longname=None, block_index=None):
        # validate (db, source, destination, asset, quantity, divisible,             ,callable_, call_date, call_price, description, block_index)
        "validate": [
            {
                "in": (
                    ADDR[0],
                    None,
                    "ASSET",
                    1000,
                    True,
                    None,
                    None,
                    False,
                    None,
                    None,
                    "",
                    None,
                    None,
                    DP["default_block_index"],
                ),
                "out": (0, 0.0, [], 50000000, "", True, False, False, False, None),
            },
            {
                "in": (
                    P2SH_ADDR[0],
                    None,
                    "ASSET",
                    1000,
                    True,
                    None,
                    None,
                    False,
                    None,
                    None,
                    "",
                    None,
                    None,
                    DP["default_block_index"],
                ),
                "out": (0, 0.0, [], 50000000, "", True, False, False, False, None),
            },
            {
                "in": (
                    ADDR[2],
                    None,
                    "DIVIDEND",
                    1000,
                    False,
                    None,
                    None,
                    False,
                    None,
                    None,
                    "",
                    None,
                    None,
                    DP["default_block_index"],
                ),
                "out": (
                    0,
                    0.0,
                    ["cannot change divisibility"],
                    0,
                    "",
                    False,
                    False,
                    False,
                    True,
                    None,
                ),
            },
            {
                # disabled for now because conftest.ALWAYS_LATEST_PROTOCOL_CHANGES = True
                #
                #    'in': (ADDR[2], None, 'DIVIDEND', 1000, True, None, None, True, None, None, '', None, None, DP['default_block_index']),
                #    'out': (0, 0.0, ['cannot change callability'], 0, '', True, True, False, False, None)
                # }, {
                "in": (
                    ADDR[0],
                    None,
                    "BTC",
                    1000,
                    True,
                    None,
                    None,
                    False,
                    None,
                    None,
                    "",
                    None,
                    None,
                    DP["default_block_index"],
                ),
                "out": (
                    0,
                    0.0,
                    ["cannot issue BTC or XCP"],
                    50000000,
                    "",
                    True,
                    False,
                    False,
                    False,
                    None,
                ),
            },
            {
                "in": (
                    ADDR[0],
                    None,
                    "XCP",
                    1000,
                    True,
                    None,
                    None,
                    False,
                    None,
                    None,
                    "",
                    None,
                    None,
                    DP["default_block_index"],
                ),
                "out": (
                    0,
                    0.0,
                    ["cannot issue BTC or XCP"],
                    50000000,
                    "",
                    True,
                    False,
                    False,
                    False,
                    None,
                ),
            },
            {
                "in": (
                    ADDR[0],
                    None,
                    "NOSATOSHI",
                    1000.5,
                    True,
                    None,
                    None,
                    False,
                    None,
                    None,
                    "",
                    None,
                    None,
                    DP["default_block_index"],
                ),
                "out": (0, 0.0, ["quantity must be in satoshis"], 0, "", True, None, None),
            },
            {
                "in": (
                    ADDR[0],
                    None,
                    "CALLPRICEFLOAT",
                    1000,
                    True,
                    None,
                    None,
                    False,
                    None,
                    100.0,
                    "",
                    None,
                    None,
                    DP["default_block_index"],
                ),
                "out": (0, 0.0, [], 0, "", True, False, False, False, None),
            },
            {
                "in": (
                    ADDR[0],
                    None,
                    "CALLPRICEINT",
                    1000,
                    True,
                    None,
                    None,
                    False,
                    None,
                    100,
                    "",
                    None,
                    None,
                    DP["default_block_index"],
                ),
                "out": (0, 0.0, [], 50000000, "", True, False, False, False, None),
            },
            {
                "in": (
                    ADDR[0],
                    None,
                    "CALLPRICESTR",
                    1000,
                    True,
                    None,
                    None,
                    False,
                    None,
                    "abc",
                    "",
                    None,
                    None,
                    DP["default_block_index"],
                ),
                "out": (0, "abc", ["call_price must be a float"], 0, "", True, None, None),
            },
            {
                "in": (
                    ADDR[0],
                    None,
                    "CALLDATEINT",
                    1000,
                    True,
                    None,
                    None,
                    False,
                    1409401723,
                    None,
                    "",
                    None,
                    None,
                    DP["default_block_index"],
                ),
                "out": (0, 0.0, [], 50000000, "", True, False, False, False, None),
            },
            {
                "in": (
                    ADDR[0],
                    None,
                    "CALLDATEFLOAT",
                    1000,
                    True,
                    None,
                    None,
                    False,
                    0.9 * 1409401723,
                    None,
                    "",
                    None,
                    None,
                    DP["default_block_index"],
                ),
                "out": (
                    1268461550.7,
                    0.0,
                    ["call_date must be epoch integer"],
                    0,
                    "",
                    True,
                    None,
                    None,
                ),
            },
            {
                "in": (
                    ADDR[0],
                    None,
                    "CALLDATESTR",
                    1000,
                    True,
                    None,
                    None,
                    False,
                    "abc",
                    None,
                    "",
                    None,
                    None,
                    DP["default_block_index"],
                ),
                "out": (
                    "abc",
                    0.0,
                    ["call_date must be epoch integer"],
                    0,
                    "",
                    True,
                    None,
                    None,
                ),
            },
            {
                "in": (
                    ADDR[0],
                    None,
                    "NEGVALUES",
                    -1000,
                    True,
                    None,
                    None,
                    True,
                    -1409401723,
                    -DP["quantity"],
                    "",
                    None,
                    None,
                    DP["default_block_index"],
                ),
                "out": (
                    -1409401723,
                    -100000000.0,
                    ["negative quantity", "negative call price", "negative call date"],
                    50000000,
                    "",
                    True,
                    False,
                    False,
                    False,
                    None,
                ),
            },
            {
                "in": (
                    ADDR[2],
                    None,
                    "DIVISIBLE",
                    1000,
                    True,
                    None,
                    None,
                    False,
                    None,
                    None,
                    "Divisible asset",
                    None,
                    None,
                    DP["default_block_index"],
                ),
                "out": (
                    0,
                    0.0,
                    ["issued by another address"],
                    0,
                    "Divisible asset",
                    True,
                    False,
                    False,
                    True,
                    None,
                ),
            },
            {
                "in": (
                    ADDR[0],
                    None,
                    "LOCKED",
                    1000,
                    True,
                    None,
                    None,
                    False,
                    None,
                    None,
                    "Locked asset",
                    None,
                    None,
                    DP["default_block_index"],
                ),
                "out": (
                    0,
                    0.0,
                    ["locked asset and non‐zero quantity"],
                    0,
                    "Locked asset",
                    True,
                    False,
                    False,
                    True,
                    None,
                ),
            },
            {
                "in": (
                    ADDR[0],
                    None,
                    "BSSET",
                    1000,
                    True,
                    None,
                    None,
                    False,
                    None,
                    None,
                    "LOCK",
                    None,
                    None,
                    DP["default_block_index"],
                ),
                "out": (
                    0,
                    0.0,
                    ["cannot lock a non‐existent asset"],
                    50000000,
                    "LOCK",
                    True,
                    False,
                    False,
                    False,
                    None,
                ),
            },
            {
                # Now it's possible to issue and transfer simultaneously
                "in": (
                    ADDR[0],
                    ADDR[1],
                    "BSSET",
                    1000,
                    True,
                    None,
                    None,
                    False,
                    None,
                    None,
                    "",
                    None,
                    None,
                    DP["default_block_index"],
                ),
                "out": (0, 0.0, [], 50000000, "", True, False, False, False, None),
            },
            {
                "in": (
                    ADDR[2],
                    None,
                    "BSSET",
                    1000,
                    True,
                    None,
                    None,
                    False,
                    None,
                    None,
                    "",
                    None,
                    None,
                    DP["default_block_index"],
                ),
                "out": (
                    0,
                    0.0,
                    ["insufficient funds"],
                    50000000,
                    "",
                    True,
                    False,
                    False,
                    False,
                    None,
                ),
            },
            {
                "in": (
                    ADDR[0],
                    None,
                    "BSSET",
                    2**63,
                    True,
                    None,
                    None,
                    False,
                    None,
                    None,
                    "",
                    None,
                    None,
                    DP["default_block_index"],
                ),
                "out": (
                    0,
                    0.0,
                    ["total quantity overflow", "integer overflow"],
                    50000000,
                    "",
                    True,
                    False,
                    False,
                    False,
                    None,
                ),
            },
            {
                # Now it's possible to issue and transfer simultaneously
                "in": (
                    ADDR[0],
                    ADDR[1],
                    "DIVISIBLE",
                    1000,
                    True,
                    None,
                    None,
                    False,
                    None,
                    None,
                    "Divisible asset",
                    None,
                    None,
                    DP["default_block_index"],
                ),
                "out": (0, 0.0, [], 0, "Divisible asset", True, False, False, True, None),
            },
            {
                "in": (
                    ADDR[0],
                    None,
                    "MAXIMUM",
                    2**63 - 1,
                    True,
                    None,
                    None,
                    False,
                    None,
                    None,
                    "Maximum quantity",
                    None,
                    None,
                    DP["default_block_index"],
                ),
                "out": (
                    0,
                    0.0,
                    [],
                    50000000,
                    "Maximum quantity",
                    True,
                    False,
                    False,
                    False,
                    None,
                ),
            },
            {
                "comment": "total + quantity has to be lower than MAX_INT",
                "in": (
                    ADDR[0],
                    None,
                    "DIVISIBLE",
                    2**63 - 1,
                    True,
                    None,
                    None,
                    False,
                    None,
                    None,
                    "Maximum quantity",
                    None,
                    None,
                    DP["default_block_index"],
                ),
                "out": (
                    0,
                    0.0,
                    ["total quantity overflow"],
                    0,
                    "Maximum quantity",
                    True,
                    False,
                    False,
                    True,
                    None,
                ),
            },
            {
                "mock_protocol_changes": {"free_subassets": False},
                "in": (
                    ADDR[0],
                    None,
                    f"A{26**12 + 1}",
                    1000,
                    True,
                    None,
                    None,
                    False,
                    None,
                    None,
                    "description",
                    "NOTFOUND",
                    "NOTFOUND.child1",
                    DP["default_block_index"],
                ),
                "out": (
                    0,
                    0.0,
                    ["parent asset not found"],
                    25000000,
                    "description",
                    True,
                    False,
                    False,
                    False,
                    None,
                ),
            },
            {
                "mock_protocol_changes": {"free_subassets": False},
                "in": (
                    ADDR[1],
                    None,
                    f"A{26**12 + 1}",
                    100000000,
                    True,
                    None,
                    None,
                    False,
                    None,
                    None,
                    "description",
                    "PARENT",
                    "PARENT.child1",
                    DP["default_block_index"],
                ),
                "out": (
                    0,
                    0.0,
                    ["parent asset owned by another address"],
                    25000000,
                    "description",
                    True,
                    False,
                    False,
                    False,
                    None,
                ),
            },
            {
                "mock_protocol_changes": {"free_subassets": False},
                "in": (
                    ADDR[0],
                    None,
                    f"A{26**12 + 1}",
                    100000000,
                    True,
                    None,
                    None,
                    False,
                    None,
                    None,
                    "description",
                    "NOTFOUND",
                    "NOTFOUND.child1",
                    DP["default_block_index"],
                ),
                "out": (
                    0,
                    0.0,
                    ["parent asset not found"],
                    25000000,
                    "description",
                    True,
                    False,
                    False,
                    False,
                    None,
                ),
            },
            {
                "mock_protocol_changes": {"free_subassets": False},
                "comment": "A subasset name must be unique",
                "in": (
                    ADDR[0],
                    None,
                    f"A{26**12 + 1}",
                    100000000,
                    True,
                    None,
                    None,
                    False,
                    None,
                    None,
                    "description",
                    "PARENT",
                    "PARENT.already.issued",
                    DP["default_block_index"],
                ),
                "out": (
                    0,
                    0.0,
                    ["subasset already exists"],
                    25000000,
                    "description",
                    True,
                    False,
                    False,
                    False,
                    None,
                ),
            },
            {
                "comment": "cannot change subasset name through a reissuance description modification",
                "in": (
                    ADDR[0],
                    None,
                    f"A{26**12 + 101}",
                    200000000,
                    True,
                    None,
                    None,
                    False,
                    None,
                    None,
                    "description",
                    "PARENT",
                    "PARENT.changed.name",
                    DP["default_block_index"],
                ),
                "out": (
                    0,
                    0.0,
                    [],
                    0,
                    "description",
                    True,
                    False,
                    False,
                    True,
                    "PARENT.already.issued",
                ),
            },
            {
                "mock_protocol_changes": {"free_subassets": False},
                "in": (
                    ADDR[0],
                    None,
                    "UNRELATED",
                    1000,
                    True,
                    None,
                    None,
                    False,
                    None,
                    None,
                    "description",
                    "PARENT",
                    "PARENT.child1",
                    DP["default_block_index"],
                ),
                "out": (
                    0,
                    0.0,
                    ["a subasset must be a numeric asset"],
                    25000000,
                    "description",
                    True,
                    False,
                    False,
                    False,
                    None,
                ),
            },
            {
                "comment": "subassets are free after protocol change",
                "in": (
                    ADDR[0],
                    None,
                    "UNRELATED",
                    1000,
                    True,
                    None,
                    None,
                    False,
                    None,
                    None,
                    "description",
                    "PARENT",
                    "PARENT.child1",
                    DP["default_block_index"],
                ),
                "out": (
                    0,
                    0.0,
                    ["a subasset must be a numeric asset"],
                    0,
                    "description",
                    True,
                    False,
                    False,
                    False,
                    None,
                ),
            },
            {
                # before protocol change, reissuing a quantity of a locked asset was allowed if the description was changed
                "comment": "allow reissuance of locked asset before fix",
                "mock_protocol_changes": {"issuance_lock_fix": False},
                "in": (
                    ADDR[6],
                    None,
                    "LOCKEDPREV",
                    1000,
                    True,
                    None,
                    None,
                    False,
                    None,
                    None,
                    "Locked prev",
                    None,
                    None,
                    DP["default_block_index"],
                ),
                "out": (0, 0.0, [], 0, "Locked prev", True, False, False, True, None),
            },
            {
                # after protocol change, reissuing quantities for a locked asset is never allowed
                "comment": "disallow reissuance of locked asset after fix",
                "mock_protocol_changes": {"issuance_lock_fix": True},
                "in": (
                    ADDR[6],
                    None,
                    "LOCKEDPREV",
                    1000,
                    True,
                    None,
                    None,
                    False,
                    None,
                    None,
                    "Locked prev",
                    None,
                    None,
                    DP["default_block_index"],
                ),
                "out": (
                    0,
                    0.0,
                    ["locked asset and non‐zero quantity"],
                    0,
                    "Locked prev",
                    True,
                    False,
                    False,
                    True,
                    None,
                ),
            },
        ],
        # compose (db, source, transfer_destination, asset, quantity, divisible, lock, reset=None, description=None)
        "compose": [
            {
                "in": (ADDR[0], "ASSET", 1000, None, True, False, None, ""),
                "error": (exceptions.AssetNameError, "non‐numeric asset name starts with ‘A’"),
            },
            {
                "in": (ADDR[0], "BSSET1", 1000, None, True, False, None, ""),
                "error": (exceptions.AssetNameError, "invalid character:"),
            },
            {
                "in": (ADDR[0], "SET", 1000, None, True, False, None, ""),
                "error": (exceptions.AssetNameError, "too short"),
            },
            {
                "comment": "disallow subassets on numerics",
                "mock_protocol_changes": {"allow_subassets_on_numerics": False},
                "in": (
                    ADDR[0],
                    "A9542895.subasset",
                    1000,
                    None,
                    True,
                    False,
                    None,
                    "",
                ),
                "error": (exceptions.AssetNameError, "parent asset name starts with 'A'"),
            },
            {
                "comment": "allow subassets on numerics",
                "in": (
                    ADDR[0],
                    "A95428956661682177.subasset",
                    1000,
                    None,
                    True,
                    False,
                    None,
                    "",
                ),
                "error": (exceptions.ComposeError, ["parent asset not found"]),
            },
            {
                "in": (ADDR[0], "BSSET", 1000, None, True, False, None, ""),
                "out": (
                    "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                    [],
                    b"\x00\x00\x00\x16\x00\x00\x00\x00\x00\x0b\xfc\xe3\x00\x00\x00\x00\x00\x00\x03\xe8\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00",
                ),
            },
            {
                "in": (ADDR[0], "BASSET", 1000, None, True, False, None, ""),
                "out": (
                    "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                    [],
                    b"\x00\x00\x00\x16\x00\x00\x00\x00\x00\xbaOs\x00\x00\x00\x00\x00\x00\x03\xe8\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00",
                ),
            },
            {
                "in": (P2SH_ADDR[0], "BSSET", 1000, None, True, False, None, ""),
                "out": (
                    P2SH_ADDR[0],
                    [],
                    b"\x00\x00\x00\x16\x00\x00\x00\x00\x00\x0b\xfc\xe3\x00\x00\x00\x00\x00\x00\x03\xe8\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00",
                ),
            },
            {
                "in": (
                    ADDR[0],
                    "BSSET",
                    1000,
                    None,
                    True,
                    False,
                    None,
                    "description much much much longer than 42 letters",
                ),
                "out": (
                    "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                    [],
                    b"\x00\x00\x00\x16\x00\x00\x00\x00\x00\x0b\xfc\xe3\x00\x00\x00\x00\x00\x00\x03\xe8\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00description much much much longer than 42 letters",
                ),
            },
            {
                "in": (ADDR[0], "DIVISIBLE", 0, ADDR[1], True, False, None, ""),
                "out": (
                    "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                    [("mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns", None)],
                    b"\x00\x00\x00\x16\x00\x00\x00\xa2[\xe3Kf\x00\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00",
                ),
            },
            {
                "in": (MULTISIGADDR[0], "BSSET", 1000, None, True, False, None, ""),
                "out": (
                    "1_mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc_mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns_2",
                    [],
                    b"\x00\x00\x00\x16\x00\x00\x00\x00\x00\x0b\xfc\xe3\x00\x00\x00\x00\x00\x00\x03\xe8\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00",
                ),
            },
            {
                "in": (ADDR[0], "DIVISIBLE", 0, MULTISIGADDR[0], True, False, None, ""),
                "out": (
                    "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                    [
                        (
                            "1_mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc_mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns_2",
                            None,
                        )
                    ],
                    b"\x00\x00\x00\x16\x00\x00\x00\xa2[\xe3Kf\x00\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00",
                ),
            },
            {
                "in": (
                    ADDR[0],
                    "MAXIMUM",
                    2**63 - 1,
                    None,
                    True,
                    False,
                    None,
                    "Maximum quantity",
                ),
                "out": (
                    "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                    [],
                    b"\x00\x00\x00\x16\x00\x00\x00\x00\xdd\x96\xd2t\x7f\xff\xff\xff\xff\xff\xff\xff\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00Maximum quantity",
                ),
            },
            {
                "in": (ADDR[0], f"A{2**64 - 1}", 1000, None, None, False, None, None),
                "out": (
                    "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                    [],
                    b"\x00\x00\x00\x16\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\x00\x00\x03\xe8\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\xc0NULL",
                ),
            },
            {
                "in": (ADDR[0], f"A{2**64}", 1000, None, True, False, None, ""),
                "error": (exceptions.AssetNameError, "numeric asset name not in range"),
            },
            {
                "in": (ADDR[0], f"A{26**12}", 1000, None, True, False, None, ""),
                "error": (exceptions.AssetNameError, "numeric asset name not in range"),
            },
            {
                "comment": "basic child asset",
                "in": (ADDR[0], "PARENT.child1", 100000000, None, True, False, None, ""),
                "out": (
                    "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                    [],
                    binascii.unhexlify(
                        "0000001701530821671b10010000000005f5e100010a57c6f36de23a1f5f4c46"
                    ),
                ),
                # 00000017|01530821671b1001|0000000005f5e100|01|0a|57c6f36de23a1f5f4c46
                # 00000015|01530821671b1001|0000000005f5e100|01|0a|57c6f36de23a1f5f4c46
            },
            {
                "comment": "basic child asset with description",
                "in": (
                    ADDR[0],
                    "PARENT.child1",
                    100000000,
                    None,
                    True,
                    False,
                    None,
                    "hello world",
                ),
                "out": (
                    "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                    [],
                    binascii.unhexlify(
                        "0000001701530821671b10010000000005f5e100010a57c6f36de23a1f5f4c4668656c6c6f20776f726c64"
                    ),
                ),
                # 00000017|01530821671b1001|0000000005f5e100|01|0a|57c6f36de23a1f5f4c46|68656c6c6f20776f726c64
                # 00000015|01530821671b1001|0000000005f5e100|01|0a|57c6f36de23a1f5f4c46|68656c6c6f20776f726c64
                #     |           |               |           |  |   |                   |
                #     |           |               |           |  |   |                   └─── Description - "hello world"
                #     |           |               |           |  |   └─── Subasset (compacted) - "PARENT.child1"
                #     |           |               |           |  └─── Length of the subasset data (up to 255) - 10
                #     |           |               |           └─── divisible (1 byte)
                #     |           |               └───── quantity (8 bytes) - 100000000
                #     |           └────────────────── asset name (8 bytes) - Numeric asset A95428956661682177 (26**12 + 1)
                #     └────────────────── Type ID (4 bytes) - type 21/subasset
            },
            {
                "in": (ADDR[0], "PARENT.a.b.c", 1000, None, True, False, None, ""),
                "out": (
                    "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                    [],
                    binascii.unhexlify(
                        "0000001701530821671b100100000000000003e8010a014a74856171ca3c559f"
                    ),
                ),
                # 00000017|01530821671b1001|00000000000003e8|01|0a|014a74856171ca3c559f
                # 00000015|01530821671b1001|00000000000003e8|01|0a|014a74856171ca3c559f
            },
            {
                "in": (ADDR[0], "PARENT.a-zA-Z0-9.-_@!", 1000, None, True, False, None, ""),
                "out": (
                    "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                    [],
                    binascii.unhexlify(
                        "0000001701530821671b100100000000000003e801108e90a57dba99d3a77b0a2470b1816edb"
                    ),
                ),
                # 00000017|01530821671b1001|00000000000003e8|01|10|8e90a57dba99d3a77b0a2470b1816edb
            },
            {
                "comment": "make sure compose catches asset name syntax errors",
                "in": (ADDR[0], "BADASSETx.child1", 1000, None, True, False, None, ""),
                "error": (
                    exceptions.AssetNameError,
                    "parent asset name contains invalid character:",
                ),
            },
            {
                "comment": "make sure compose catches validation errors",
                "in": (ADDR[1], "PARENT.child1", 1000, None, True, False, None, ""),
                "error": (exceptions.ComposeError, ["parent asset owned by another address"]),
            },
            {
                "comment": "referencing parent asset by name composes a reissuance",
                "in": (ADDR[0], "PARENT.already.issued", 1000, None, True, False, None, ""),
                "out": (
                    "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                    [],
                    b"\x00\x00\x00\x16\x01S\x08!g\x1b\x10e\x00\x00\x00\x00\x00\x00\x03\xe8\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00",
                ),
            },
            {
                "comment": "basic child asset with compact message type id",
                "mock_protocol_changes": {"short_tx_type_id": True},
                "in": (ADDR[0], "PARENT.child1", 100000000, None, True, False, None, ""),
                "out": (
                    "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                    [],
                    binascii.unhexlify(
                        "1701530821671b10010000000005f5e100010a57c6f36de23a1f5f4c46"
                    ),
                ),
                # 17|01530821671b1001|0000000005f5e100|01|0a|57c6f36de23a1f5f4c46
            },
            {
                "in": (
                    ADDR[0],
                    f"A{26**12 + 101}",
                    200000000,
                    None,
                    True,
                    None,
                    None,
                    "description",
                ),
                "out": (
                    "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                    [],
                    b"\x00\x00\x00\x16\x01S\x08!g\x1b\x10e\x00\x00\x00\x00\x0b\xeb\xc2\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00description",
                ),
            },
            {
                "in": (
                    ADDR[0],
                    "DIVISIBLEB",
                    0,
                    ADDR[1],
                    True,
                    False,
                    None,
                    "second divisible asset",
                ),
                "out": (
                    "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                    [("mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns", None)],
                    b"\x00\x00\x00\x16\x00\x00\x10}U\x15\xa8]\x00\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00second divisible asset",
                ),
            },
            {
                "in": (
                    ADDR[0],
                    "DIVISIBLEC",
                    0,
                    None,
                    True,
                    True,
                    None,
                    "third divisible asset",
                ),
                "out": (
                    "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                    [],
                    b"\x00\x00\x00\x16\x00\x00\x10}U\x15\xa8^\x00\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00third divisible asset",
                ),
            },
        ],
        "parse": [
            {
                "comment": "first",
                "in": (
                    {
                        "supported": 1,
                        "tx_hash": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                        "data": b"\x00\x00\x00\x16\x00\x00\x00\x00\x00\xbaOs\x00\x00\x00\x00\x00\x00\x03\xe8\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00",
                        "btc_amount": None,
                        "destination": None,
                        "block_time": 155409000,
                        "block_index": DP["default_block_index"],
                        "source": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                        "fee": 10000,
                        "tx_index": DP["default_tx_index"],
                        "block_hash": DP["default_block_hash"],
                    },
                    issuance.ID,
                ),
                "records": [
                    {
                        "table": "issuances",
                        "values": {
                            "asset": "BASSET",
                            "block_index": DP["default_block_index"],
                            "description": "",
                            "divisible": 1,
                            "fee_paid": 50000000,
                            "issuer": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "locked": 0,
                            "quantity": 1000,
                            "source": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "status": "valid",
                            "transfer": 0,
                            "tx_hash": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "tx_index": DP["default_tx_index"],
                            "asset_longname": None,
                        },
                    },
                    {
                        "table": "credits",
                        "values": {
                            "address": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "asset": "BASSET",
                            "block_index": DP["default_block_index"],
                            "calling_function": "issuance",
                            "event": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "quantity": 1000,
                        },
                    },
                    {
                        "table": "debits",
                        "values": {
                            "action": "issuance fee",
                            "address": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "asset": "XCP",
                            "block_index": DP["default_block_index"],
                            "event": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "quantity": 50000000,
                        },
                    },
                ],
            },
            {
                "in": (
                    {
                        "source": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                        "block_time": 155409000,
                        "btc_amount": 7800,
                        "supported": 1,
                        "tx_index": DP["default_tx_index"],
                        "block_index": DP["default_block_index"],
                        "data": b"\x00\x00\x00\x16\x00\x00\x10}U\x15\xa8]\x00\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00second divisible asset",
                        "block_hash": DP["default_block_hash"],
                        "tx_hash": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                        "fee": 10000,
                        "destination": "mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns",
                    },
                    issuance.ID,
                ),
                "records": [
                    {
                        "table": "issuances",
                        "values": {
                            "asset": "DIVISIBLEB",
                            "asset_longname": None,
                            "block_index": DP["default_block_index"],
                            "description": "second divisible asset",
                            "divisible": 1,
                            "fee_paid": 50000000,
                            "issuer": "mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns",
                            "locked": 0,
                            "quantity": 0,
                            "source": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "status": "valid",
                            "transfer": 1,
                            "tx_hash": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "tx_index": DP["default_tx_index"],
                        },
                    }
                ],
            },
            {
                "in": (
                    {
                        "tx_index": DP["default_tx_index"],
                        "source": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                        "tx_hash": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                        "data": b"\x00\x00\x00\x16\x00\x00\x10}U\x15\xa8^\x00\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00third divisible asset",
                        "block_time": 155409000,
                        "block_hash": DP["default_block_hash"],
                        "fee": 10000,
                        "destination": None,
                        "supported": 1,
                        "block_index": DP["default_block_index"],
                        "btc_amount": None,
                    },
                    issuance.ID,
                ),
                "records": [
                    {
                        "table": "issuances",
                        "values": {
                            "asset": "DIVISIBLEC",
                            "asset_longname": None,
                            "block_index": DP["default_block_index"],
                            "description": "third divisible asset",
                            "divisible": 1,
                            "fee_paid": 50000000,
                            "issuer": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "locked": 0,  # lock arg ignored
                            "quantity": 0,
                            "source": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "status": "valid",
                            "transfer": 0,
                            "tx_hash": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "tx_index": DP["default_tx_index"],
                        },
                    }
                ],
            },
            {
                "in": (
                    {
                        "data": b"\x00\x00\x00\x16\x00\x00\x00\x00\x00\x0b\xfc\xe3\x00\x00\x00\x00\x00\x00\x03\xe8\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\xc0NULL",
                        "supported": 1,
                        "tx_hash": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                        "block_index": DP["default_block_index"],
                        "destination": "",
                        "source": "1_mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc_mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns_2",
                        "btc_amount": 0,
                        "tx_index": DP["default_tx_index"],
                        "block_hash": DP["default_block_hash"],
                        "block_time": 155409000,
                        "fee": 10000,
                    },
                    issuance.ID,
                ),
                "records": [
                    {
                        "table": "issuances",
                        "values": {
                            "asset": "BSSET",
                            "asset_longname": None,
                            "block_index": DP["default_block_index"],
                            "description": "",
                            "divisible": 1,
                            "fee_paid": 50000000,
                            "issuer": "1_mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc_mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns_2",
                            "locked": 0,
                            "quantity": 1000,
                            "source": "1_mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc_mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns_2",
                            "status": "valid",
                            "transfer": 0,
                            "tx_hash": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "tx_index": DP["default_tx_index"],
                        },
                    },
                    {
                        "table": "credits",
                        "values": {
                            "address": "1_mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc_mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns_2",
                            "asset": "BSSET",
                            "block_index": DP["default_block_index"],
                            "calling_function": "issuance",
                            "event": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "quantity": 1000,
                        },
                    },
                    {
                        "table": "debits",
                        "values": {
                            "action": "issuance fee",
                            "address": "1_mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc_mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns_2",
                            "asset": "XCP",
                            "block_index": DP["default_block_index"],
                            "event": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "quantity": 50000000,
                        },
                    },
                ],
            },
            {
                "in": (
                    {
                        "fee": 10000,
                        "block_time": 155409000,
                        "data": b"\x00\x00\x00\x16\x00\x00\x00\xa2[\xe3Kf\x00\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00",
                        "block_index": DP["default_block_index"],
                        "block_hash": DP["default_block_hash"],
                        "tx_hash": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                        "btc_amount": 7800,
                        "tx_index": DP["default_tx_index"],
                        "destination": "1_mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc_mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns_2",
                        "supported": 1,
                        "source": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                    },
                    issuance.ID,
                ),
                "records": [
                    {
                        "table": "issuances",
                        "values": {
                            "asset": "DIVISIBLE",
                            "asset_longname": None,
                            "block_index": DP["default_block_index"],
                            "description": "",
                            "divisible": 1,
                            "fee_paid": 0,
                            "issuer": "1_mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc_mtQheFaSfWELRB2MyMBaiWjdDm6ux9Ezns_2",
                            "locked": 0,
                            "quantity": 0,
                            "source": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "status": "valid",
                            "transfer": 1,
                            "tx_hash": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "tx_index": DP["default_tx_index"],
                        },
                    },
                    {
                        "table": "debits",
                        "values": {
                            "action": "issuance fee",
                            "address": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "asset": "XCP",
                            "block_index": DP["default_block_index"],
                            "event": "db6d9052b576d973196363e11163d492f50926c2f1d1efd67b3d999817b0d04d",
                            "quantity": 0,
                        },
                    },
                ],
            },
            {
                "in": (
                    {
                        "data": b"\x00\x00\x00\x16\x00\x00\x00\x00\xdd\x96\xd2t\x7f\xff\xff\xff\xff\xff\xff\xff\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00Maximum quantity",
                        "block_time": 155409000,
                        "source": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                        "block_hash": DP["default_block_hash"],
                        "block_index": DP["default_block_index"],
                        "btc_amount": 0,
                        "fee": 10000,
                        "supported": 1,
                        "tx_index": DP["default_tx_index"],
                        "destination": "",
                        "tx_hash": "71da4fac29d6442ef3ff13f291860f512a888161ae9e574f313562851912aace",
                    },
                    issuance.ID,
                ),
                "records": [
                    {
                        "table": "issuances",
                        "values": {
                            "asset": "MAXIMUM",
                            "asset_longname": None,
                            "block_index": DP["default_block_index"],
                            "description": "Maximum quantity",
                            "fee_paid": 50000000,
                            "issuer": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "locked": 0,
                            "quantity": 9223372036854775807,
                            "source": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "status": "valid",
                            "transfer": 0,
                            "divisible": 1,
                            "tx_hash": "71da4fac29d6442ef3ff13f291860f512a888161ae9e574f313562851912aace",
                            "tx_index": DP["default_tx_index"],
                        },
                    },
                    {
                        "table": "credits",
                        "values": {
                            "address": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "asset": "MAXIMUM",
                            "block_index": DP["default_block_index"],
                            "calling_function": "issuance",
                            "event": "71da4fac29d6442ef3ff13f291860f512a888161ae9e574f313562851912aace",
                            "quantity": 9223372036854775807,
                        },
                    },
                    {
                        "table": "debits",
                        "values": {
                            "action": "issuance fee",
                            "address": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "asset": "XCP",
                            "block_index": DP["default_block_index"],
                            "event": "71da4fac29d6442ef3ff13f291860f512a888161ae9e574f313562851912aace",
                            "quantity": 50000000,
                        },
                    },
                ],
            },
            {
                "in": (
                    {
                        "data": b"\x00\x00\x00\x16\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\x00\x00\x03\xe8\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\xc0NULL",
                        "tx_index": DP["default_tx_index"],
                        "tx_hash": "4188c1f7aaae56ce3097ef256cdbcb644dd43c84e237b4add4f24fd4848cb2c7",
                        "destination": "",
                        "fee": 10000,
                        "btc_amount": 0,
                        "block_time": 2815010000000,
                        "source": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                        "supported": 1,
                        "block_index": DP["default_block_index"],
                        "block_hash": "8e80b430efbe3e1b7cc13d7ec51c1e47a16b0fa23d6dd3c939fb6c4d4cfa311e1f25072500f5f9872373b54c72424b3557fccd68915d00c0afb6523702e11b6a",
                    },
                    issuance.ID,
                ),
                "records": [
                    {
                        "table": "issuances",
                        "values": {
                            "asset": "A18446744073709551615",
                            "asset_longname": None,
                            "block_index": DP["default_block_index"],
                            "description": "",
                            "divisible": 1,
                            "fee_paid": 0,
                            "issuer": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "locked": 0,
                            "quantity": 1000,
                            "source": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "status": "valid",
                            "transfer": 0,
                            "tx_hash": "4188c1f7aaae56ce3097ef256cdbcb644dd43c84e237b4add4f24fd4848cb2c7",
                            "tx_index": DP["default_tx_index"],
                        },
                    },
                    {
                        "table": "credits",
                        "values": {
                            "address": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "asset": "A18446744073709551615",
                            "block_index": DP["default_block_index"],
                            "calling_function": "issuance",
                            "event": "4188c1f7aaae56ce3097ef256cdbcb644dd43c84e237b4add4f24fd4848cb2c7",
                            "quantity": 1000,
                        },
                    },
                    {
                        "table": "debits",
                        "values": {
                            "action": "issuance fee",
                            "address": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "asset": "XCP",
                            "block_index": DP["default_block_index"],
                            "event": "4188c1f7aaae56ce3097ef256cdbcb644dd43c84e237b4add4f24fd4848cb2c7",
                            "quantity": 0,
                        },
                    },
                ],
            },
            {
                "comment": "too short asset length",
                # 00000014|00000000000002bf|0000000005f5e100|01
                #     |           |               |           |
                #     |           |               |           └─── divisible (1 byte)
                #     |           |               └───── quantity (8 bytes) - 100000000
                #     |           └────────────────── asset name (8 bytes) - BBB (invalid)
                #     └────────────────── Type ID (4 bytes) - type 20/issuance
                "in": (
                    {
                        "data": binascii.unhexlify("0000001400000000000002bf0000000005f5e10001"),
                        "block_time": 155409000,
                        "source": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                        "block_hash": DP["default_block_hash"],
                        "block_index": DP["default_block_index"],
                        "btc_amount": 0,
                        "fee": 10000,
                        "supported": 1,
                        "tx_index": DP["default_tx_index"],
                        "destination": "",
                        "tx_hash": "71da4fac29d6442ef3ff13f291860f512a888161ae9e574f313562851912aace",
                    },
                    issuance.ID,
                ),
                "records": [
                    {
                        "table": "issuances",
                        "values": {
                            "asset": None,
                            "asset_longname": None,
                            "block_index": DP["default_block_index"],
                            "description": None,
                            "fee_paid": 0,
                            "issuer": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "locked": 0,
                            "quantity": None,
                            "source": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "status": "invalid: bad asset name",
                            "transfer": 0,
                            "divisible": None,
                            "tx_hash": "71da4fac29d6442ef3ff13f291860f512a888161ae9e574f313562851912aace",
                            "tx_index": DP["default_tx_index"],
                        },
                    }
                ],
            },
            {
                "mock_protocol_changes": {"free_subassets": False},
                "comment": "first time issuance of subasset",
                "in": (
                    {
                        "data": binascii.unhexlify(
                            "0000001501530821671b10010000000005f5e100010a57c6f36de23a1f5f4c46"
                        ),
                        "block_time": 155409000,
                        "source": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                        "block_hash": DP["default_block_hash"],
                        "block_index": DP["default_block_index"],
                        "btc_amount": 0,
                        "fee": 10000,
                        "supported": 1,
                        "tx_index": DP["default_tx_index"],
                        "destination": "",
                        "tx_hash": "71da4fac29d6442ef3ff13f291860f512a888161ae9e574f313562851912aace",
                    },
                    issuance.SUBASSET_ID,
                ),
                "records": [
                    {
                        "table": "issuances",
                        "values": {
                            "asset": f"A{26**12 + 1}",
                            "asset_longname": "PARENT.child1",
                            "block_index": DP["default_block_index"],
                            "description": "",
                            "fee_paid": 25000000,
                            "issuer": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "locked": 0,
                            "quantity": 100000000,
                            "source": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "status": "valid",
                            "transfer": 0,
                            "divisible": 1,
                            "tx_hash": "71da4fac29d6442ef3ff13f291860f512a888161ae9e574f313562851912aace",
                            "tx_index": DP["default_tx_index"],
                        },
                    },
                    {
                        "table": "credits",
                        "values": {
                            "address": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "asset": f"A{26**12 + 1}",
                            "block_index": DP["default_block_index"],
                            "calling_function": "issuance",
                            "event": "71da4fac29d6442ef3ff13f291860f512a888161ae9e574f313562851912aace",
                            "quantity": 100000000,
                        },
                    },
                    {
                        "table": "debits",
                        "values": {
                            "action": "issuance fee",
                            "address": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "asset": "XCP",
                            "block_index": DP["default_block_index"],
                            "event": "71da4fac29d6442ef3ff13f291860f512a888161ae9e574f313562851912aace",
                            "quantity": 25000000,
                        },
                    },
                    {
                        "table": "assets",
                        "values": {
                            "asset_id": int(26**12 + 1),
                            "asset_name": f"A{26**12 + 1}",
                            "block_index": DP["default_block_index"],
                            "asset_longname": "PARENT.child1",
                        },
                    },
                ],
            },
            {
                "mock_protocol_changes": {"free_subassets": False},
                "comment": "first time issuance of subasset with description",
                "in": (
                    {
                        "data": binascii.unhexlify(
                            "0000001501530821671b10010000000005f5e100010a57c6f36de23a1f5f4c4668656c6c6f20776f726c64"
                        ),
                        "block_time": 155409000,
                        "source": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                        "block_hash": DP["default_block_hash"],
                        "block_index": DP["default_block_index"],
                        "btc_amount": 0,
                        "fee": 10000,
                        "supported": 1,
                        "tx_index": DP["default_tx_index"],
                        "destination": "",
                        "tx_hash": "71da4fac29d6442ef3ff13f291860f512a888161ae9e574f313562851912aace",
                    },
                    issuance.SUBASSET_ID,
                ),
                "records": [
                    {
                        "table": "issuances",
                        "values": {
                            "asset": f"A{26**12 + 1}",
                            "asset_longname": "PARENT.child1",
                            "block_index": DP["default_block_index"],
                            "description": "hello world",
                            "fee_paid": 25000000,
                            "issuer": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "locked": 0,
                            "quantity": 100000000,
                            "source": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "status": "valid",
                            "transfer": 0,
                            "divisible": 1,
                            "tx_hash": "71da4fac29d6442ef3ff13f291860f512a888161ae9e574f313562851912aace",
                            "tx_index": DP["default_tx_index"],
                        },
                    },
                    {
                        "table": "credits",
                        "values": {
                            "address": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "asset": f"A{26**12 + 1}",
                            "block_index": DP["default_block_index"],
                            "calling_function": "issuance",
                            "event": "71da4fac29d6442ef3ff13f291860f512a888161ae9e574f313562851912aace",
                            "quantity": 100000000,
                        },
                    },
                    {
                        "table": "debits",
                        "values": {
                            "action": "issuance fee",
                            "address": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "asset": "XCP",
                            "block_index": DP["default_block_index"],
                            "event": "71da4fac29d6442ef3ff13f291860f512a888161ae9e574f313562851912aace",
                            "quantity": 25000000,
                        },
                    },
                    {
                        "table": "assets",
                        "values": {
                            "asset_id": int(26**12 + 1),
                            "asset_name": f"A{26**12 + 1}",
                            "block_index": DP["default_block_index"],
                            "asset_longname": "PARENT.child1",
                        },
                    },
                ],
            },
            {
                "comment": "subassets not enabled yet",
                "in": (
                    {
                        "data": binascii.unhexlify(
                            "0000001501530821671b10010000000005f5e100010a57c6f36de23a1f5f4c46"
                        ),
                        "block_time": 155409000,
                        "source": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                        "block_hash": DP["default_block_hash"],
                        "block_index": DP["default_block_index"],
                        "btc_amount": 0,
                        "fee": 10000,
                        "supported": 1,
                        "tx_index": DP["default_tx_index"],
                        "destination": "",
                        "tx_hash": "71da4fac29d6442ef3ff13f291860f512a888161ae9e574f313562851912aace",
                    },
                    issuance.SUBASSET_ID,
                ),
                "mock_protocol_changes": {"subassets": False},
                "records": [
                    {
                        "table": "issuances",
                        "values": {
                            "asset": None,
                            "asset_longname": None,
                            "block_index": DP["default_block_index"],
                            "description": None,
                            "fee_paid": 0,
                            "issuer": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "locked": 0,
                            "quantity": None,
                            "source": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "status": "invalid: could not unpack",
                            "transfer": 0,
                            "divisible": None,
                            "tx_hash": "71da4fac29d6442ef3ff13f291860f512a888161ae9e574f313562851912aace",
                            "tx_index": DP["default_tx_index"],
                        },
                    }
                ],
            },
            {
                "comment": "invalid subasset length",
                "in": (
                    {
                        "data": binascii.unhexlify(
                            "0000001501530821671b10010000000005f5e10001f057c6f36de23a1f5f4c46"
                        ),
                        "block_time": 155409000,
                        "source": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                        "block_hash": DP["default_block_hash"],
                        "block_index": DP["default_block_index"],
                        "btc_amount": 0,
                        "fee": 10000,
                        "supported": 1,
                        "tx_index": DP["default_tx_index"],
                        "destination": "",
                        "tx_hash": "71da4fac29d6442ef3ff13f291860f512a888161ae9e574f313562851912aace",
                    },
                    issuance.SUBASSET_ID,
                ),
                "records": [
                    {
                        "table": "issuances",
                        "values": {
                            "asset": None,
                            "asset_longname": None,
                            "block_index": DP["default_block_index"],
                            "description": None,
                            "fee_paid": 0,
                            "issuer": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "locked": 0,
                            "quantity": None,
                            "source": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "status": "invalid: could not unpack",
                            "transfer": 0,
                            "divisible": None,
                            "tx_hash": "71da4fac29d6442ef3ff13f291860f512a888161ae9e574f313562851912aace",
                            "tx_index": DP["default_tx_index"],
                        },
                    }
                ],
            },
            {
                "comment": "first time issuance of subasset with description",
                "in": (
                    {
                        "data": binascii.unhexlify(
                            "0000001501530821671b10010000000005f5e100010c0631798cf0c65f1507f66fdf"
                        ),
                        "block_time": 155409000,
                        "source": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                        "block_hash": DP["default_block_hash"],
                        "block_index": DP["default_block_index"],
                        "btc_amount": 0,
                        "fee": 10000,
                        "supported": 1,
                        "tx_index": DP["default_tx_index"],
                        "destination": "",
                        "tx_hash": "71da4fac29d6442ef3ff13f291860f512a888161ae9e574f313562851912aace",
                    },
                    issuance.SUBASSET_ID,
                ),
                "records": [
                    {
                        "table": "issuances",
                        "values": {
                            "asset": None,
                            "asset_longname": None,
                            "block_index": DP["default_block_index"],
                            "description": None,
                            "fee_paid": 0,
                            "issuer": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "locked": 0,
                            "quantity": None,
                            "source": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "status": "invalid: bad subasset name",
                            "transfer": 0,
                            "divisible": None,
                            "tx_hash": "71da4fac29d6442ef3ff13f291860f512a888161ae9e574f313562851912aace",
                            "tx_index": DP["default_tx_index"],
                        },
                    }
                ],
            },
            {
                "comment": "missing subasset name",
                "in": (
                    {
                        "data": binascii.unhexlify("0000001501530821671b10010000000005f5e100010c"),
                        "block_time": 155409000,
                        "source": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                        "block_hash": DP["default_block_hash"],
                        "block_index": DP["default_block_index"],
                        "btc_amount": 0,
                        "fee": 10000,
                        "supported": 1,
                        "tx_index": DP["default_tx_index"],
                        "destination": "",
                        "tx_hash": "71da4fac29d6442ef3ff13f291860f512a888161ae9e574f313562851912aace",
                    },
                    issuance.SUBASSET_ID,
                ),
                "records": [
                    {
                        "table": "issuances",
                        "values": {
                            "asset": None,
                            "asset_longname": None,
                            "block_index": DP["default_block_index"],
                            "description": None,
                            "fee_paid": 0,
                            "issuer": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "locked": 0,
                            "quantity": None,
                            "source": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "status": "invalid: could not unpack",
                            "transfer": 0,
                            "divisible": None,
                            "tx_hash": "71da4fac29d6442ef3ff13f291860f512a888161ae9e574f313562851912aace",
                            "tx_index": DP["default_tx_index"],
                        },
                    }
                ],
            },
            {
                "comment": "subasset length of zero",
                "in": (
                    {
                        "data": binascii.unhexlify("0000001501530821671b10010000000005f5e1000100"),
                        "block_time": 155409000,
                        "source": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                        "block_hash": DP["default_block_hash"],
                        "block_index": DP["default_block_index"],
                        "btc_amount": 0,
                        "fee": 10000,
                        "supported": 1,
                        "tx_index": DP["default_tx_index"],
                        "destination": "",
                        "tx_hash": "71da4fac29d6442ef3ff13f291860f512a888161ae9e574f313562851912aace",
                    },
                    issuance.SUBASSET_ID,
                ),
                "records": [
                    {
                        "table": "issuances",
                        "values": {
                            "asset": None,
                            "asset_longname": None,
                            "block_index": DP["default_block_index"],
                            "description": None,
                            "fee_paid": 0,
                            "issuer": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "locked": 0,
                            "quantity": None,
                            "source": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "status": "invalid: bad subasset name",
                            "transfer": 0,
                            "divisible": None,
                            "tx_hash": "71da4fac29d6442ef3ff13f291860f512a888161ae9e574f313562851912aace",
                            "tx_index": DP["default_tx_index"],
                        },
                    }
                ],
            },
            {
                "comment": "bad subasset B.bad",
                "in": (
                    {
                        "data": binascii.unhexlify(
                            "0000001501530821671b10010000000005f5e100010509cad71adf"
                        ),
                        "block_time": 155409000,
                        "source": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                        "block_hash": DP["default_block_hash"],
                        "block_index": DP["default_block_index"],
                        "btc_amount": 0,
                        "fee": 10000,
                        "supported": 1,
                        "tx_index": DP["default_tx_index"],
                        "destination": "",
                        "tx_hash": "71da4fac29d6442ef3ff13f291860f512a888161ae9e574f313562851912aace",
                    },
                    issuance.SUBASSET_ID,
                ),
                "records": [
                    {
                        "table": "issuances",
                        "values": {
                            "asset": None,
                            "asset_longname": None,
                            "block_index": DP["default_block_index"],
                            "description": None,
                            "fee_paid": 0,
                            "issuer": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "locked": 0,
                            "quantity": None,
                            "source": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "status": "invalid: bad subasset name",
                            "transfer": 0,
                            "divisible": None,
                            "tx_hash": "71da4fac29d6442ef3ff13f291860f512a888161ae9e574f313562851912aace",
                            "tx_index": DP["default_tx_index"],
                        },
                    }
                ],
            },
            {
                "comment": "reissuance of subasset adds asset_longname to issuances table",
                "in": (
                    {
                        "data": b"\x00\x00\x00\x16\x01S\x08!g\x1b\x10e\x00\x00\x00\x00\x0b\xeb\xc2\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00description",
                        "block_time": 155409000,
                        "source": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                        "block_hash": DP["default_block_hash"],
                        "block_index": DP["default_block_index"],
                        "btc_amount": 0,
                        "fee": 10000,
                        "supported": 1,
                        "tx_index": DP["default_tx_index"],
                        "destination": "",
                        "tx_hash": "71da4fac29d6442ef3ff13f291860f512a888161ae9e574f313562851912aace",
                    },
                    issuance.ID,
                ),
                "records": [
                    {
                        "table": "issuances",
                        "values": {
                            "asset": f"A{26**12 + 101}",
                            "asset_longname": "PARENT.already.issued",
                            "block_index": DP["default_block_index"],
                            "description": "description",
                            "fee_paid": 0,
                            "issuer": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "locked": 0,
                            "quantity": 200000000,
                            "source": "mn6q3dS2EnDUx3bmyWc6D4szJNVGtaR7zc",
                            "status": "valid",
                            "transfer": 0,
                            "divisible": 1,
                            "tx_hash": "71da4fac29d6442ef3ff13f291860f512a888161ae9e574f313562851912aace",
                            "tx_index": DP["default_tx_index"],
                        },
                    },
                ],
            },
        ],
    },
}
